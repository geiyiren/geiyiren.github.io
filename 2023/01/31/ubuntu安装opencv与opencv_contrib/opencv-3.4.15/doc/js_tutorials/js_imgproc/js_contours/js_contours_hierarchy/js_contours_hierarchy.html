<h1 id="Contours-Hierarchy-tutorial-js-contours-hierarchy"><a href="#Contours-Hierarchy-tutorial-js-contours-hierarchy" class="headerlink" title="Contours Hierarchy {#tutorial_js_contours_hierarchy}"></a>Contours Hierarchy {#tutorial_js_contours_hierarchy}</h1><h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><ul>
<li>This time, we learn about the hierarchy of contours, i.e. the parent-child relationship in Contours.</li>
</ul>
<h2 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h2><p>In the last few articles on contours, we have worked with several functions related to contours<br>provided by OpenCV. But when we found the contours in image using <strong>cv.findContours()</strong> function,<br>we have passed an argument, <strong>Contour Retrieval Mode</strong>. We usually passed <strong>cv.RETR_LIST</strong> or<br><strong>cv.RETR_TREE</strong> and it worked nice. But what does it actually mean ?</p>
<p>Also, in the output, we got three arrays, first is the image, second is our contours, and one more<br>output which we named as <strong>hierarchy</strong> (Please checkout the codes in previous articles). But we<br>never used this hierarchy anywhere. Then what is this hierarchy and what is it for ? What is its<br>relationship with the previous mentioned function argument ?</p>
<p>That is what we are going to deal in this article.</p>
<h3 id="What-is-Hierarchy"><a href="#What-is-Hierarchy" class="headerlink" title="What is Hierarchy?"></a>What is Hierarchy?</h3><p>Normally we use the <strong>cv.findContours()</strong> function to detect objects in an image, right ? Sometimes<br>objects are in different locations. But in some cases, some shapes are inside other shapes. Just<br>like nested figures. In this case, we call outer one as <strong>parent</strong> and inner one as <strong>child</strong>. This<br>way, contours in an image has some relationship to each other. And we can specify how one contour is<br>connected to each other, like, is it child of some other contour, or is it a parent etc.<br>Representation of this relationship is called the <strong>Hierarchy</strong>.</p>
<p>Consider an example image below :</p>
<p><img src="/images/hierarchy.png" alt="image"></p>
<p>In this image, there are a few shapes which I have numbered from <strong>0-5</strong>. <em>2 and 2a</em> denotes the<br>external and internal contours of the outermost box.</p>
<p>Here, contours 0,1,2 are <strong>external or outermost</strong>. We can say, they are in <strong>hierarchy-0</strong> or<br>simply they are in <strong>same hierarchy level</strong>.</p>
<p>Next comes <strong>contour-2a</strong>. It can be considered as a <strong>child of contour-2</strong> (or in opposite way,<br>contour-2 is parent of contour-2a). So let it be in <strong>hierarchy-1</strong>. Similarly contour-3 is child of<br>contour-2a and it comes in next hierarchy. Finally contours 4,5 are the children of contour-3a, and<br>they come in the last hierarchy level. From the way I numbered the boxes, I would say contour-4 is<br>the first child of contour-3a (It can be contour-5 also).</p>
<p>I mentioned these things to understand terms like <strong>same hierarchy level</strong>, <strong>external contour</strong>,<br><strong>child contour</strong>, <strong>parent contour</strong>, <strong>first child</strong> etc. Now let’s get into OpenCV.</p>
<h3 id="Hierarchy-Representation-in-OpenCV"><a href="#Hierarchy-Representation-in-OpenCV" class="headerlink" title="Hierarchy Representation in OpenCV"></a>Hierarchy Representation in OpenCV</h3><p>So each contour has its own information regarding what hierarchy it is, who is its child, who is its<br>parent etc. OpenCV represents it as an array of four values : <strong>[Next, Previous, First_Child,<br>Parent]</strong></p>
<center>*"Next denotes next contour at the same hierarchical level."*</center>

<p>For eg, take contour-0 in our picture. Who is next contour in its same level ? It is contour-1. So<br>simply put Next &#x3D; 1. Similarly for Contour-1, next is contour-2. So Next &#x3D; 2.</p>
<p>What about contour-2? There is no next contour in the same level. So simply, put Next &#x3D; -1. What<br>about contour-4? It is in same level with contour-5. So its next contour is contour-5, so Next &#x3D; 5.</p>
<center>*"Previous denotes previous contour at the same hierarchical level."*</center>

<p>It is same as above. Previous contour of contour-1 is contour-0 in the same level. Similarly for<br>contour-2, it is contour-1. And for contour-0, there is no previous, so put it as -1.</p>
<center>*"First_Child denotes its first child contour."*</center>

<p>There is no need of any explanation. For contour-2, child is contour-2a. So it gets the<br>corresponding index value of contour-2a. What about contour-3a? It has two children. But we take<br>only first child. And it is contour-4. So First_Child &#x3D; 4 for contour-3a.</p>
<center>*"Parent denotes index of its parent contour."*</center>

<p>It is just opposite of <strong>First_Child</strong>. Both for contour-4 and contour-5, parent contour is<br>contour-3a. For contour-3a, it is contour-3 and so on.</p>
<p>@note If there is no child or parent, that field is taken as -1</p>
<p>So now we know about the hierarchy style used in OpenCV, we can check into Contour Retrieval Modes<br>in OpenCV with the help of same image given above. ie what do flags like cv.RETR_LIST,<br>cv.RETR_TREE, cv.RETR_CCOMP, cv.RETR_EXTERNAL etc mean?</p>
<h2 id="Contour-Retrieval-Mode"><a href="#Contour-Retrieval-Mode" class="headerlink" title="Contour Retrieval Mode"></a>Contour Retrieval Mode</h2><h3 id="1-RETR-LIST"><a href="#1-RETR-LIST" class="headerlink" title="1. RETR_LIST"></a>1. RETR_LIST</h3><p>This is the simplest of the four flags (from explanation point of view). It simply retrieves all the<br>contours, but doesn’t create any parent-child relationship. <strong>Parents and kids are equal under this<br>rule, and they are just contours</strong>. ie they all belongs to same hierarchy level.</p>
<p>So here, 3rd and 4th term in hierarchy array is always -1. But obviously, Next and Previous terms<br>will have their corresponding values.</p>
<h3 id="2-RETR-EXTERNAL"><a href="#2-RETR-EXTERNAL" class="headerlink" title="2. RETR_EXTERNAL"></a>2. RETR_EXTERNAL</h3><p>If you use this flag, it returns only extreme outer flags. All child contours are left behind. <strong>We<br>can say, under this law, Only the eldest in every family is taken care of. It doesn’t care about<br>other members of the family)</strong>.</p>
<h3 id="3-RETR-CCOMP"><a href="#3-RETR-CCOMP" class="headerlink" title="3. RETR_CCOMP"></a>3. RETR_CCOMP</h3><p>This flag retrieves all the contours and arranges them to a 2-level hierarchy. ie external contours<br>of the object (ie its boundary) are placed in hierarchy-1. And the contours of holes inside object<br>(if any) is placed in hierarchy-2. If any object inside it, its contour is placed again in<br>hierarchy-1 only. And its hole in hierarchy-2 and so on.</p>
<p>Just consider the image of a “big white zero” on a black background. Outer circle of zero belongs to<br>first hierarchy, and inner circle of zero belongs to second hierarchy.</p>
<p>We can explain it with a simple image. Here I have labelled the order of contours in red color and<br>the hierarchy they belongs to, in green color (either 1 or 2). The order is same as the order OpenCV<br>detects contours.</p>
<p><img src="/images/ccomp_hierarchy.png" alt="image"></p>
<p>So consider first contour, ie contour-0. It is hierarchy-1. It has two holes, contours 1&amp;2, and they<br>belong to hierarchy-2. So for contour-0, Next contour in same hierarchy level is contour-3. And<br>there is no previous one. And its first is child is contour-1 in hierarchy-2. It has no parent,<br>because it is in hierarchy-1. So its hierarchy array is [3,-1,1,-1]</p>
<p>Now take contour-1. It is in hierarchy-2. Next one in same hierarchy (under the parenthood of<br>contour-1) is contour-2. No previous one. No child, but parent is contour-0. So array is<br>[2,-1,-1,0].</p>
<p>Similarly contour-2 : It is in hierarchy-2. There is not next contour in same hierarchy under<br>contour-0. So no Next. Previous is contour-1. No child, parent is contour-0. So array is<br>[-1,1,-1,0].</p>
<p>Contour - 3 : Next in hierarchy-1 is contour-5. Previous is contour-0. Child is contour-4 and no<br>parent. So array is [5,0,4,-1].</p>
<p>Contour - 4 : It is in hierarchy 2 under contour-3 and it has no sibling. So no next, no previous,<br>no child, parent is contour-3. So array is [-1,-1,-1,3].</p>
<h3 id="4-RETR-TREE"><a href="#4-RETR-TREE" class="headerlink" title="4. RETR_TREE"></a>4. RETR_TREE</h3><p>And this is the final guy, Mr.Perfect. It retrieves all the contours and creates a full family<br>hierarchy list. <strong>It even tells, who is the grandpa, father, son, grandson and even beyond… :)</strong>.</p>
<p>For example, I took above image, rewrite the code for cv.RETR_TREE, reorder the contours as per the<br>result given by OpenCV and analyze it. Again, red letters give the contour number and green letters<br>give the hierarchy order.</p>
<p><img src="/images/tree_hierarchy.png" alt="image"></p>
<p>Take contour-0 : It is in hierarchy-0. Next contour in same hierarchy is contour-7. No previous<br>contours. Child is contour-1. And no parent. So array is [7,-1,1,-1].</p>
<p>Take contour-2 : It is in hierarchy-1. No contour in same level. No previous one. Child is<br>contour-2. Parent is contour-0. So array is [-1,-1,2,0].</p>
