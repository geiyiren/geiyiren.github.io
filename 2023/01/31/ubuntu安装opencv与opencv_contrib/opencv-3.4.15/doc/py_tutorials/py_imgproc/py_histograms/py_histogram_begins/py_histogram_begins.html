<h1 id="Histograms-1-Find-Plot-Analyze-tutorial-py-histogram-begins"><a href="#Histograms-1-Find-Plot-Analyze-tutorial-py-histogram-begins" class="headerlink" title="Histograms - 1 : Find, Plot, Analyze !!! {#tutorial_py_histogram_begins}"></a>Histograms - 1 : Find, Plot, Analyze !!! {#tutorial_py_histogram_begins}</h1><h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>Learn to<br>    -   Find histograms, using both OpenCV and Numpy functions<br>    -   Plot histograms, using OpenCV and Matplotlib functions<br>    -   You will see these functions : <strong>cv.calcHist()</strong>, <strong>np.histogram()</strong> etc.</p>
<h2 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h2><p>So what is histogram ? You can consider histogram as a graph or plot, which gives you an overall<br>idea about the intensity distribution of an image. It is a plot with pixel values (ranging from 0 to<br>255, not always) in X-axis and corresponding number of pixels in the image on Y-axis.</p>
<p>It is just another way of understanding the image. By looking at the histogram of an image, you get<br>intuition about contrast, brightness, intensity distribution etc of that image. Almost all image<br>processing tools today, provides features on histogram. Below is an image from <a href="http://www.cambridgeincolour.com/tutorials/histograms1.htm">Cambridge in Color<br>website</a>, and I recommend you to visit<br>the site for more details.</p>
<p><img src="/images/histogram_sample.jpg" alt="image"></p>
<p>You can see the image and its histogram. (Remember, this histogram is drawn for grayscale image, not<br>color image). Left region of histogram shows the amount of darker pixels in image and right region<br>shows the amount of brighter pixels. From the histogram, you can see dark region is more than<br>brighter region, and amount of midtones (pixel values in mid-range, say around 127) are very less.</p>
<h2 id="Find-Histogram"><a href="#Find-Histogram" class="headerlink" title="Find Histogram"></a>Find Histogram</h2><p>Now we have an idea on what is histogram, we can look into how to find this. Both OpenCV and Numpy<br>come with in-built function for this. Before using those functions, we need to understand some<br>terminologies related with histograms.</p>
<p><strong>BINS</strong> :The above histogram shows the number of pixels for every pixel value, ie from 0 to 255. ie<br>you need 256 values to show the above histogram. But consider, what if you need not find the number<br>of pixels for all pixel values separately, but number of pixels in a interval of pixel values? say<br>for example, you need to find the number of pixels lying between 0 to 15, then 16 to 31, …, 240 to 255.<br>You will need only 16 values to represent the histogram. And that is what is shown in example<br>given in @ref tutorial_histogram_calculation “OpenCV Tutorials on histograms”.</p>
<p>So what you do is simply split the whole histogram to 16 sub-parts and value of each sub-part is the<br>sum of all pixel count in it. This each sub-part is called “BIN”. In first case, number of bins<br>were 256 (one for each pixel) while in second case, it is only 16. BINS is represented by the term<br><strong>histSize</strong> in OpenCV docs.</p>
<p><strong>DIMS</strong> : It is the number of parameters for which we collect the data. In this case, we collect<br>data regarding only one thing, intensity value. So here it is 1.</p>
<p><strong>RANGE</strong> : It is the range of intensity values you want to measure. Normally, it is [0,256], ie all<br>intensity values.</p>
<h3 id="1-Histogram-Calculation-in-OpenCV"><a href="#1-Histogram-Calculation-in-OpenCV" class="headerlink" title="1. Histogram Calculation in OpenCV"></a>1. Histogram Calculation in OpenCV</h3><p>So now we use <strong>cv.calcHist()</strong> function to find the histogram. Let’s familiarize with the function<br>and its parameters :</p>
<center><em>cv.calcHist(images, channels, mask, histSize, ranges[, hist[, accumulate]])</em></center>

<p>-#  images : it is the source image of type uint8 or float32. it should be given in square brackets,<br>    ie, “[img]”.<br>-#  channels : it is also given in square brackets. It is the index of channel for which we<br>    calculate histogram. For example, if input is grayscale image, its value is [0]. For color<br>    image, you can pass [0], [1] or [2] to calculate histogram of blue, green or red channel<br>    respectively.<br>-#  mask : mask image. To find histogram of full image, it is given as “None”. But if you want to<br>    find histogram of particular region of image, you have to create a mask image for that and give<br>    it as mask. (I will show an example later.)<br>-#  histSize : this represents our BIN count. Need to be given in square brackets. For full scale,<br>    we pass [256].<br>-#  ranges : this is our RANGE. Normally, it is [0,256].</p>
<p>So let’s start with a sample image. Simply load an image in grayscale mode and find its full<br>histogram.<br>@code{.py}<br>img &#x3D; cv.imread(‘home.jpg’,0)<br>hist &#x3D; cv.calcHist([img],[0],None,[256],[0,256])<br>@endcode<br>hist is a 256x1 array, each value corresponds to number of pixels in that image with its<br>corresponding pixel value.</p>
<h3 id="2-Histogram-Calculation-in-Numpy"><a href="#2-Histogram-Calculation-in-Numpy" class="headerlink" title="2. Histogram Calculation in Numpy"></a>2. Histogram Calculation in Numpy</h3><p>Numpy also provides you a function, <strong>np.histogram()</strong>. So instead of calcHist() function, you can<br>try below line :<br>@code{.py}<br>hist,bins &#x3D; np.histogram(img.ravel(),256,[0,256])<br>@endcode<br>hist is same as we calculated before. But bins will have 257 elements, because Numpy calculates bins<br>as 0-0.99, 1-1.99, 2-2.99 etc. So final range would be 255-255.99. To represent that, they also add<br>256 at end of bins. But we don’t need that 256. Upto 255 is sufficient.</p>
<p>@note Numpy has another function, <strong>np.bincount()</strong> which is much faster than (around 10X)<br>np.histogram(). So for one-dimensional histograms, you can better try that. Don’t forget to set<br>minlength &#x3D; 256 in np.bincount. For example, hist &#x3D; np.bincount(img.ravel(),minlength&#x3D;256)</p>
<p>@note OpenCV function is faster than (around 40X) than np.histogram(). So stick with OpenCV<br>function.</p>
<p>Now we should plot histograms, but how?</p>
<h2 id="Plotting-Histograms"><a href="#Plotting-Histograms" class="headerlink" title="Plotting Histograms"></a>Plotting Histograms</h2><p>There are two ways for this,<br>    -#  Short Way : use Matplotlib plotting functions<br>    -#  Long Way : use OpenCV drawing functions</p>
<h3 id="1-Using-Matplotlib"><a href="#1-Using-Matplotlib" class="headerlink" title="1. Using Matplotlib"></a>1. Using Matplotlib</h3><p>Matplotlib comes with a histogram plotting function : matplotlib.pyplot.hist()</p>
<p>It directly finds the histogram and plot it. You need not use calcHist() or np.histogram() function<br>to find the histogram. See the code below:<br>@code{.py}<br>import numpy as np<br>import cv2 as cv<br>from matplotlib import pyplot as plt</p>
<p>img &#x3D; cv.imread(‘home.jpg’,0)<br>plt.hist(img.ravel(),256,[0,256]); plt.show()<br>@endcode<br>You will get a plot as below :</p>
<p><img src="/images/histogram_matplotlib.jpg" alt="image"></p>
<p>Or you can use normal plot of matplotlib, which would be good for BGR plot. For that, you need to<br>find the histogram data first. Try below code:<br>@code{.py}<br>import numpy as np<br>import cv2 as cv<br>from matplotlib import pyplot as plt</p>
<p>img &#x3D; cv.imread(‘home.jpg’)<br>color &#x3D; (‘b’,’g’,’r’)<br>for i,col in enumerate(color):<br>    histr &#x3D; cv.calcHist([img],[i],None,[256],[0,256])<br>    plt.plot(histr,color &#x3D; col)<br>    plt.xlim([0,256])<br>plt.show()<br>@endcode<br>Result:</p>
<p><img src="/images/histogram_rgb_plot.jpg" alt="image"></p>
<p>You can deduct from the above graph that, blue has some high value areas in the image (obviously it<br>should be due to the sky)</p>
<h3 id="2-Using-OpenCV"><a href="#2-Using-OpenCV" class="headerlink" title="2. Using OpenCV"></a>2. Using OpenCV</h3><p>Well, here you adjust the values of histograms along with its bin values to look like x,y<br>coordinates so that you can draw it using cv.line() or cv.polyline() function to generate same<br>image as above. This is already available with OpenCV-Python2 official samples. Check the<br>code at samples&#x2F;python&#x2F;hist.py.</p>
<h2 id="Application-of-Mask"><a href="#Application-of-Mask" class="headerlink" title="Application of Mask"></a>Application of Mask</h2><p>We used cv.calcHist() to find the histogram of the full image. What if you want to find histograms<br>of some regions of an image? Just create a mask image with white color on the region you want to<br>find histogram and black otherwise. Then pass this as the mask.<br>@code{.py}<br>img &#x3D; cv.imread(‘home.jpg’,0)</p>
<h1 id="create-a-mask"><a href="#create-a-mask" class="headerlink" title="create a mask"></a>create a mask</h1><p>mask &#x3D; np.zeros(img.shape[:2], np.uint8)<br>mask[100:300, 100:400] &#x3D; 255<br>masked_img &#x3D; cv.bitwise_and(img,img,mask &#x3D; mask)</p>
<h1 id="Calculate-histogram-with-mask-and-without-mask"><a href="#Calculate-histogram-with-mask-and-without-mask" class="headerlink" title="Calculate histogram with mask and without mask"></a>Calculate histogram with mask and without mask</h1><h1 id="Check-third-argument-for-mask"><a href="#Check-third-argument-for-mask" class="headerlink" title="Check third argument for mask"></a>Check third argument for mask</h1><p>hist_full &#x3D; cv.calcHist([img],[0],None,[256],[0,256])<br>hist_mask &#x3D; cv.calcHist([img],[0],mask,[256],[0,256])</p>
<p>plt.subplot(221), plt.imshow(img, ‘gray’)<br>plt.subplot(222), plt.imshow(mask,’gray’)<br>plt.subplot(223), plt.imshow(masked_img, ‘gray’)<br>plt.subplot(224), plt.plot(hist_full), plt.plot(hist_mask)<br>plt.xlim([0,256])</p>
<p>plt.show()<br>@endcode<br>See the result. In the histogram plot, blue line shows histogram of full image while green line<br>shows histogram of masked region.</p>
<p><img src="/images/histogram_masking.jpg" alt="image"></p>
<h2 id="Additional-Resources"><a href="#Additional-Resources" class="headerlink" title="Additional Resources"></a>Additional Resources</h2><p>-#  <a href="http://www.cambridgeincolour.com/tutorials/histograms1.htm">Cambridge in Color website</a></p>
<h2 id="Exercises"><a href="#Exercises" class="headerlink" title="Exercises"></a>Exercises</h2>