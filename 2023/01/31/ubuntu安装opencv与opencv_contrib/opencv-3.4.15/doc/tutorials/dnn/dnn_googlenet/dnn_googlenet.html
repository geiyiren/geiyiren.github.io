<h1 id="Load-Caffe-framework-models-tutorial-dnn-googlenet"><a href="#Load-Caffe-framework-models-tutorial-dnn-googlenet" class="headerlink" title="Load Caffe framework models  {#tutorial_dnn_googlenet}"></a>Load Caffe framework models  {#tutorial_dnn_googlenet}</h1><p>@next_tutorial{tutorial_dnn_halide}</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this tutorial you will learn how to use opencv_dnn module for image classification by using<br>GoogLeNet trained network from <a href="http://caffe.berkeleyvision.org/model_zoo.html">Caffe model zoo</a>.</p>
<p>We will demonstrate results of this example on the following picture.<br><img src="/images/space_shuttle.jpg" alt="Buran space shuttle"></p>
<h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><p>We will be using snippets from the example application, that can be downloaded <a href="https://github.com/opencv/opencv/blob/3.4/samples/dnn/classification.cpp">here</a>.</p>
<p>@include dnn&#x2F;classification.cpp</p>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>-# Firstly, download GoogLeNet model files:<br>   <a href="https://github.com/opencv/opencv_extra/blob/master/testdata/dnn/bvlc_googlenet.prototxt">bvlc_googlenet.prototxt  </a> and<br>   <a href="http://dl.caffe.berkeleyvision.org/bvlc_googlenet.caffemodel">bvlc_googlenet.caffemodel</a></p>
<p>   Also you need file with names of <a href="http://image-net.org/challenges/LSVRC/2012/browse-synsets">ILSVRC2012</a> classes:<br>   <a href="https://github.com/opencv/opencv/blob/3.4/samples/data/dnn/classification_classes_ILSVRC2012.txt">classification_classes_ILSVRC2012.txt</a>.</p>
<p>   Put these files into working dir of this program example.</p>
<p>-# Read and initialize network using path to .prototxt and .caffemodel files<br>   @snippet dnn&#x2F;classification.cpp Read and initialize network</p>
<p>   You can skip an argument <code>framework</code> if one of the files <code>model</code> or <code>config</code> has an<br>   extension <code>.caffemodel</code> or <code>.prototxt</code>.<br>   This way function cv::dnn::readNet can automatically detects a model’s format.</p>
<p>-# Read input image and convert to the blob, acceptable by GoogleNet<br>   @snippet dnn&#x2F;classification.cpp Open a video file or an image file or a camera stream</p>
<p>   cv::VideoCapture can load both images and videos.</p>
<p>   @snippet dnn&#x2F;classification.cpp Create a 4D blob from a frame<br>   We convert the image to a 4-dimensional blob (so-called batch) with <code>1x3x224x224</code> shape<br>   after applying necessary pre-processing like resizing and mean subtraction<br>   <code>(-104, -117, -123)</code> for each blue, green and red channels correspondingly using cv::dnn::blobFromImage function.</p>
<p>-# Pass the blob to the network<br>   @snippet dnn&#x2F;classification.cpp Set input blob</p>
<p>-# Make forward pass<br>   @snippet dnn&#x2F;classification.cpp Make forward pass<br>   During the forward pass output of each network layer is computed, but in this example we need output from the last layer only.</p>
<p>-# Determine the best class<br>   @snippet dnn&#x2F;classification.cpp Get a class with a highest score<br>   We put the output of network, which contain probabilities for each of 1000 ILSVRC2012 image classes, to the <code>prob</code> blob.<br>   And find the index of element with maximal value in this one. This index corresponds to the class of the image.</p>
<p>-# Run an example from command line<br>   @code<br>   .&#x2F;example_dnn_classification –model&#x3D;bvlc_googlenet.caffemodel –config&#x3D;bvlc_googlenet.prototxt –width&#x3D;224 –height&#x3D;224 –classes&#x3D;classification_classes_ILSVRC2012.txt –input&#x3D;space_shuttle.jpg –mean&#x3D;”104 117 123”<br>   @endcode<br>   For our image we get prediction of class <code>space shuttle</code> with more than 99% sureness.</p>
