<h1 id="AKAZE-local-features-matching-tutorial-akaze-matching"><a href="#AKAZE-local-features-matching-tutorial-akaze-matching" class="headerlink" title="AKAZE local features matching {#tutorial_akaze_matching}"></a>AKAZE local features matching {#tutorial_akaze_matching}</h1><p>@prev_tutorial{tutorial_detection_of_planar_objects}<br>@next_tutorial{tutorial_akaze_tracking}</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this tutorial we will learn how to use AKAZE @cite ANB13 local features to detect and match keypoints on<br>two images.<br>We will find keypoints on a pair of images with given homography matrix, match them and count the<br>number of inliers (i.e. matches that fit in the given homography).</p>
<p>You can find expanded version of this example here:<br><a href="https://github.com/pablofdezalc/test_kaze_akaze_opencv">https://github.com/pablofdezalc/test_kaze_akaze_opencv</a></p>
<h2 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h2><p>We are going to use images 1 and 3 from <em>Graffiti</em> sequence of <a href="http://www.robots.ox.ac.uk/~vgg/data/data-aff.html">Oxford dataset</a>.</p>
<p><img src="/images/graf.png"></p>
<p>Homography is given by a 3 by 3 matrix:<br>@code{.none}<br>7.6285898e-01  -2.9922929e-01   2.2567123e+02<br>3.3443473e-01   1.0143901e+00  -7.6999973e+01<br>3.4663091e-04  -1.4364524e-05   1.0000000e+00<br>@endcode<br>You can find the images (<em>graf1.png</em>, <em>graf3.png</em>) and homography (<em>H1to3p.xml</em>) in<br><em>opencv&#x2F;samples&#x2F;data&#x2F;</em>.</p>
<h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><p>@add_toggle_cpp</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://raw.githubusercontent.com/opencv/opencv/3.4/samples/cpp/tutorial_code/features2D/AKAZE_match.cpp">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;cpp&#x2F;tutorial_code&#x2F;features2D&#x2F;AKAZE_match.cpp<br>@end_toggle</p>
</li>
</ul>
<p>@add_toggle_java</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://raw.githubusercontent.com/opencv/opencv/3.4/samples/java/tutorial_code/features2D/akaze_matching/AKAZEMatchDemo.java">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;java&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZEMatchDemo.java<br>@end_toggle</p>
</li>
</ul>
<p>@add_toggle_python</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://raw.githubusercontent.com/opencv/opencv/3.4/samples/python/tutorial_code/features2D/akaze_matching/AKAZE_match.py">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;python&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZE_match.py<br>@end_toggle</p>
</li>
</ul>
<h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><ul>
<li><strong>Load images and homography</strong></li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;features2D&#x2F;AKAZE_match.cpp load<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZEMatchDemo.java load<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZE_match.py load<br>@end_toggle</p>
<p>We are loading grayscale images here. Homography is stored in the xml created with FileStorage.</p>
<ul>
<li><strong>Detect keypoints and compute descriptors using AKAZE</strong></li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;features2D&#x2F;AKAZE_match.cpp AKAZE<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZEMatchDemo.java AKAZE<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZE_match.py AKAZE<br>@end_toggle</p>
<p>We create AKAZE and detect and compute AKAZE keypoints and descriptors. Since we don’t need the <em>mask</em><br>parameter, <em>noArray()</em> is used.</p>
<ul>
<li><strong>Use brute-force matcher to find 2-nn matches</strong></li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;features2D&#x2F;AKAZE_match.cpp 2-nn matching<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZEMatchDemo.java 2-nn matching<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZE_match.py 2-nn matching<br>@end_toggle</p>
<p>We use Hamming distance, because AKAZE uses binary descriptor by default.</p>
<ul>
<li><strong>Use 2-nn matches and ratio criterion to find correct keypoint matches</strong><br>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;features2D&#x2F;AKAZE_match.cpp ratio test filtering<br>@end_toggle</li>
</ul>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZEMatchDemo.java ratio test filtering<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZE_match.py ratio test filtering<br>@end_toggle</p>
<p>If the closest match distance is significantly lower than the second closest one, then the match is correct (match is not ambiguous).</p>
<ul>
<li><strong>Check if our matches fit in the homography model</strong></li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;features2D&#x2F;AKAZE_match.cpp homography check<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZEMatchDemo.java homography check<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZE_match.py homography check<br>@end_toggle</p>
<p>If the distance from first keypoint’s projection to the second keypoint is less than threshold,<br>then it fits the homography model.</p>
<p>We create a new set of matches for the inliers, because it is required by the drawing function.</p>
<ul>
<li><strong>Output results</strong></li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;features2D&#x2F;AKAZE_match.cpp draw final matches<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZEMatchDemo.java draw final matches<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;features2D&#x2F;akaze_matching&#x2F;AKAZE_match.py draw final matches<br>@end_toggle</p>
<p>Here we save the resulting image and print some statistics.</p>
<h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><h3 id="Found-matches"><a href="#Found-matches" class="headerlink" title="Found matches"></a>Found matches</h3><p><img src="/images/res.png"></p>
<p>Depending on your OpenCV version, you should get results coherent with:</p>
<p>@code{.none}<br> Keypoints 1:   2943<br> Keypoints 2:   3511<br> Matches:       447<br> Inliers:       308<br> Inlier Ratio: 0.689038<br>@endcode</p>
