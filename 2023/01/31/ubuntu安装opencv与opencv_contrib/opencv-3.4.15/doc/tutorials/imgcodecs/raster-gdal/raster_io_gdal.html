<h1 id="Reading-Geospatial-Raster-files-with-GDAL-tutorial-raster-io-gdal"><a href="#Reading-Geospatial-Raster-files-with-GDAL-tutorial-raster-io-gdal" class="headerlink" title="Reading Geospatial Raster files with GDAL {#tutorial_raster_io_gdal}"></a>Reading Geospatial Raster files with GDAL {#tutorial_raster_io_gdal}</h1><p>Geospatial raster data is a heavily used product in Geographic Information Systems and<br>Photogrammetry. Raster data typically can represent imagery and Digital Elevation Models (DEM). The<br>standard library for loading GIS imagery is the Geographic Data Abstraction Library <a href="http://www.gdal.org/">(GDAL)</a>. In this<br>example, we will show techniques for loading GIS raster formats using native OpenCV functions. In<br>addition, we will show some an example of how OpenCV can use this data for novel and interesting<br>purposes.</p>
<h2 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h2><p>The primary objectives for this tutorial:</p>
<ul>
<li>How to use OpenCV [imread](@ref imread) to load satellite imagery.</li>
<li>How to use OpenCV [imread](@ref imread) to load SRTM Digital Elevation Models</li>
<li>Given the corner coordinates of both the image and DEM, correlate the elevation data to the<br>image to find elevations for each pixel.</li>
<li>Show a basic, easy-to-implement example of a terrain heat map.</li>
<li>Show a basic use of DEM data coupled with ortho-rectified imagery.</li>
</ul>
<p>To implement these goals, the following code takes a Digital Elevation Model as well as a GeoTiff<br>image of San Francisco as input. The image and DEM data is processed and generates a terrain heat<br>map of the image as well as labels areas of the city which would be affected should the water level<br>of the bay rise 10, 50, and 100 meters.</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p>@include cpp&#x2F;tutorial_code&#x2F;imgcodecs&#x2F;GDAL_IO&#x2F;gdal-image.cpp</p>
<h2 id="How-to-Read-Raster-Data-using-GDAL"><a href="#How-to-Read-Raster-Data-using-GDAL" class="headerlink" title="How to Read Raster Data using GDAL"></a>How to Read Raster Data using GDAL</h2><p>This demonstration uses the default OpenCV imread function. The primary difference is that in order<br>to force GDAL to load the image, you must use the appropriate flag.<br>@snippet cpp&#x2F;tutorial_code&#x2F;imgcodecs&#x2F;GDAL_IO&#x2F;gdal-image.cpp load1<br>When loading digital elevation models, the actual numeric value of each pixel is essential and<br>cannot be scaled or truncated. For example, with image data a pixel represented as a double with a<br>value of 1 has an equal appearance to a pixel which is represented as an unsigned character with a<br>value of 255. With terrain data, the pixel value represents the elevation in meters. In order to<br>ensure that OpenCV preserves the native value, use the GDAL flag in imread with the ANYDEPTH flag.<br>@snippet cpp&#x2F;tutorial_code&#x2F;imgcodecs&#x2F;GDAL_IO&#x2F;gdal-image.cpp load2<br>If you know beforehand the type of DEM model you are loading, then it may be a safe bet to test the<br>Mat::type() or Mat::depth() using an assert or other mechanism. NASA or DOD specification documents<br>can provide the input types for various elevation models. The major types, SRTM and DTED, are both<br>signed shorts.</p>
<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><h3 id="Lat-x2F-Lon-Geographic-Coordinates-should-normally-be-avoided"><a href="#Lat-x2F-Lon-Geographic-Coordinates-should-normally-be-avoided" class="headerlink" title="Lat&#x2F;Lon (Geographic) Coordinates should normally be avoided"></a>Lat&#x2F;Lon (Geographic) Coordinates should normally be avoided</h3><p>The Geographic Coordinate System is a spherical coordinate system, meaning that using them with<br>Cartesian mathematics is technically incorrect. This demo uses them to increase the readability and<br>is accurate enough to make the point. A better coordinate system would be Universal Transverse<br>Mercator.</p>
<h3 id="Finding-the-corner-coordinates"><a href="#Finding-the-corner-coordinates" class="headerlink" title="Finding the corner coordinates"></a>Finding the corner coordinates</h3><p>One easy method to find the corner coordinates of an image is to use the command-line tool gdalinfo.<br>For imagery which is ortho-rectified and contains the projection information, you can use the <a href="http://http//earthexplorer.usgs.gov">USGS<br>EarthExplorer</a>.<br>@code{.bash}<br>\f$&gt; gdalinfo N37W123.hgt</p>
<p>   Driver: SRTMHGT&#x2F;SRTMHGT File Format<br>   Files: N37W123.hgt<br>   Size is 3601, 3601<br>   Coordinate System is:<br>   GEOGCS[“WGS 84”,<br>   DATUM[“WGS_1984”,</p>
<p>   … more output …</p>
<p>   Corner Coordinates:<br>   Upper Left  (-123.0001389,  38.0001389) (123d 0’ 0.50”W, 38d 0’ 0.50”N)<br>   Lower Left  (-123.0001389,  36.9998611) (123d 0’ 0.50”W, 36d59’59.50”N)<br>   Upper Right (-121.9998611,  38.0001389) (121d59’59.50”W, 38d 0’ 0.50”N)<br>   Lower Right (-121.9998611,  36.9998611) (121d59’59.50”W, 36d59’59.50”N)<br>   Center      (-122.5000000,  37.5000000) (122d30’ 0.00”W, 37d30’ 0.00”N)</p>
<pre><code>... more output ...
</code></pre>
<h2 id="endcodeResults"><a href="#endcodeResults" class="headerlink" title="@endcodeResults"></a>@endcode<br>Results</h2><p>Below is the output of the program. Use the first image as the input. For the DEM model, download<br>the SRTM file located at the USGS here.<br><a href="http://dds.cr.usgs.gov/srtm/version2_1/SRTM1/Region_04/N37W123.hgt.zip"><a href="http://dds.cr.usgs.gov/srtm/version2_1/SRTM1/Region_04/N37W123.hgt.zip">http://dds.cr.usgs.gov/srtm/version2_1/SRTM1/Region_04/N37W123.hgt.zip</a></a></p>
<p><img src="/images/gdal_output.jpg" alt="Input Image"></p>
<p><img src="/images/gdal_heat-map.jpg" alt="Heat Map"></p>
<p><img src="/images/gdal_flood-zone.jpg" alt="Heat Map Overlay"></p>
