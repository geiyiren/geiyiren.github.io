<h1 id="Anisotropic-image-segmentation-by-a-gradient-structure-tensor-tutorial-anisotropic-image-segmentation-by-a-gst"><a href="#Anisotropic-image-segmentation-by-a-gradient-structure-tensor-tutorial-anisotropic-image-segmentation-by-a-gst" class="headerlink" title="Anisotropic image segmentation by a gradient structure tensor {#tutorial_anisotropic_image_segmentation_by_a_gst}"></a>Anisotropic image segmentation by a gradient structure tensor {#tutorial_anisotropic_image_segmentation_by_a_gst}</h1><p>@prev_tutorial{tutorial_motion_deblur_filter}<br>@next_tutorial{tutorial_periodic_noise_removing_filter}</p>
<h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>In this tutorial you will learn:</p>
<ul>
<li>what the gradient structure tensor is</li>
<li>how to estimate orientation and coherency of an anisotropic image by a gradient structure tensor</li>
<li>how to segment an anisotropic image with a single local orientation by a gradient structure tensor</li>
</ul>
<h2 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h2><p>@note The explanation is based on the books @cite jahne2000computer, @cite bigun2006vision and @cite van1995estimators. Good physical explanation of a gradient structure tensor is given in @cite yang1996structure. Also, you can refer to a wikipedia page <a href="https://en.wikipedia.org/wiki/Structure_tensor">Structure tensor</a>.<br>@note A anisotropic image on this page is a real world  image.</p>
<h3 id="What-is-the-gradient-structure-tensor"><a href="#What-is-the-gradient-structure-tensor" class="headerlink" title="What is the gradient structure tensor?"></a>What is the gradient structure tensor?</h3><p>In mathematics, the gradient structure tensor (also referred to as the second-moment matrix, the second order moment tensor, the inertia tensor, etc.) is a matrix derived from the gradient of a function. It summarizes the predominant directions of the gradient in a specified neighborhood of a point, and the degree to which those directions are coherent (coherency). The gradient structure tensor is widely used in image processing and computer vision for 2D&#x2F;3D image segmentation, motion detection, adaptive filtration, local image features detection, etc.</p>
<p>Important features of anisotropic images include orientation and coherency of a local anisotropy. In this paper we will show how to estimate orientation and coherency, and how to segment an anisotropic image with a single local orientation by a gradient structure tensor.</p>
<p>The gradient structure tensor of an image is a 2x2 symmetric matrix. Eigenvectors of the gradient structure tensor indicate local orientation, whereas eigenvalues give coherency (a measure of anisotropism).</p>
<p>The gradient structure tensor \f$J\f$ of an image \f$Z\f$ can be written as:</p>
<p>\f[J &#x3D; \begin{bmatrix}<br>J_{11} &amp; J_{12}  \<br>J_{12} &amp; J_{22}<br>\end{bmatrix}\f]</p>
<p>where \f$J_{11} &#x3D; M[Z_{x}^{2}]\f$, \f$J_{22} &#x3D; M[Z_{y}^{2}]\f$, \f$J_{12} &#x3D; M[Z_{x}Z_{y}]\f$ - components of the tensor, \f$M[]\f$ is a symbol of mathematical expectation (we can consider this operation as averaging in a window w), \f$Z_{x}\f$ and \f$Z_{y}\f$ are partial derivatives of an image \f$Z\f$ with respect to \f$x\f$ and \f$y\f$.</p>
<p>The eigenvalues of the tensor can be found in the below formula:<br>\f[\lambda_{1,2} &#x3D; \frac{1}{2} \left [ J_{11} + J_{22} \pm \sqrt{(J_{11} - J_{22})^{2} + 4J_{12}^{2}} \right ] \f]<br>where \f$\lambda_1\f$ - largest eigenvalue, \f$\lambda_2\f$ - smallest eigenvalue.</p>
<h3 id="How-to-estimate-orientation-and-coherency-of-an-anisotropic-image-by-gradient-structure-tensor"><a href="#How-to-estimate-orientation-and-coherency-of-an-anisotropic-image-by-gradient-structure-tensor" class="headerlink" title="How to estimate orientation and coherency of an anisotropic image by gradient structure tensor?"></a>How to estimate orientation and coherency of an anisotropic image by gradient structure tensor?</h3><p>The orientation of an anisotropic image:<br>\f[\alpha &#x3D; 0.5arctg\frac{2J_{12}}{J_{22} - J_{11}}\f]</p>
<p>Coherency:<br>\f[C &#x3D; \frac{\lambda_1 - \lambda_2}{\lambda_1 + \lambda_2}\f]</p>
<p>The coherency ranges from 0 to 1. For ideal local orientation (\f$\lambda_2\f$ &#x3D; 0, \f$\lambda_1\f$ &gt; 0) it is one, for an isotropic gray value structure (\f$\lambda_1\f$ &#x3D; \f$\lambda_2\f$ &gt; 0) it is zero.</p>
<h2 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h2><p>You can find source code in the <code>samples/cpp/tutorial_code/ImgProc/anisotropic_image_segmentation/anisotropic_image_segmentation.cpp</code> of the OpenCV source code library.</p>
<p>@add_toggle_cpp<br>    @include cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.cpp<br>@end_toggle</p>
<p>@add_toggle_python<br>    @include samples&#x2F;python&#x2F;tutorial_code&#x2F;imgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.py<br>@end_toggle</p>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>An anisotropic image segmentation algorithm consists of a gradient structure tensor calculation, an orientation calculation, a coherency calculation and an orientation and coherency thresholding:</p>
<p>@add_toggle_cpp<br>    @snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.cpp main<br>@end_toggle</p>
<p>@add_toggle_python<br>    @snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;imgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.py main<br>@end_toggle</p>
<p>A function calcGST() calculates orientation and coherency by using a gradient structure tensor. An input parameter w defines a window size:</p>
<p>@add_toggle_cpp<br>    @snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.cpp calcGST<br>@end_toggle</p>
<p>@add_toggle_python<br>    @snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;imgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.py calcGST<br>@end_toggle</p>
<p>The below code applies a thresholds LowThr and HighThr to image orientation and a threshold C_Thr to image coherency calculated by the previous function. LowThr and HighThr define orientation range:</p>
<p>@add_toggle_cpp<br>    @snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.cpp thresholding<br>@end_toggle</p>
<p>@add_toggle_python<br>    @snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;imgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.py thresholding<br>@end_toggle</p>
<p>And finally we combine thresholding results:</p>
<p>@add_toggle_cpp<br>    @snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.cpp combining<br>@end_toggle</p>
<p>@add_toggle_python<br>    @snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;imgProc&#x2F;anisotropic_image_segmentation&#x2F;anisotropic_image_segmentation.py combining<br>@end_toggle</p>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>Below you can see the real anisotropic image with single direction:<br><img src="/images/gst_input.jpg" alt="Anisotropic image with the single direction"></p>
<p>Below you can see the orientation and coherency of the anisotropic image:<br><img src="/images/gst_orientation.jpg" alt="Orientation"><br><img src="/images/gst_coherency.jpg" alt="Coherency"></p>
<p>Below you can see the segmentation result:<br><img src="/images/gst_result.jpg" alt="Segmentation result"></p>
<p>The result has been computed with w &#x3D; 52, C_Thr &#x3D; 0.43, LowThr &#x3D; 35, HighThr &#x3D; 57. We can see that the algorithm selected only the areas with one single direction.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://en.wikipedia.org/wiki/Structure_tensor">Structure tensor</a> - structure tensor description on the wikipedia</li>
</ul>
<!-- invisible references list -->
