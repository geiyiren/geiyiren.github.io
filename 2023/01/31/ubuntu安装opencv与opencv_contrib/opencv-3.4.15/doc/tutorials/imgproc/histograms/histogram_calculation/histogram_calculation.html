<h1 id="Histogram-Calculation-tutorial-histogram-calculation"><a href="#Histogram-Calculation-tutorial-histogram-calculation" class="headerlink" title="Histogram Calculation {#tutorial_histogram_calculation}"></a>Histogram Calculation {#tutorial_histogram_calculation}</h1><p>@prev_tutorial{tutorial_histogram_equalization}<br>@next_tutorial{tutorial_histogram_comparison}</p>
<h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>In this tutorial you will learn how to:</p>
<ul>
<li>Use the OpenCV function @ref cv::split to divide an image into its correspondent planes.</li>
<li>To calculate histograms of arrays of images by using the OpenCV function @ref cv::calcHist</li>
<li>To normalize an array by using the function @ref cv::normalize</li>
</ul>
<p>@note In the last tutorial (@ref tutorial_histogram_equalization) we talked about a particular kind of<br>histogram called <em>Image histogram</em>. Now we will considerate it in its more general concept. Read on!</p>
<h3 id="What-are-histograms"><a href="#What-are-histograms" class="headerlink" title="What are histograms?"></a>What are histograms?</h3><ul>
<li><p>Histograms are collected <em>counts</em> of data organized into a set of predefined <em>bins</em></p>
</li>
<li><p>When we say <em>data</em> we are not restricting it to be intensity values (as we saw in the previous<br>Tutorial @ref tutorial_histogram_equalization). The data collected can be whatever feature you find<br>useful to describe your image.</p>
</li>
<li><p>Let’s see an example. Imagine that a Matrix contains information of an image (i.e. intensity in<br>the range \f$0-255\f$):</p>
<p><img src="/images/Histogram_Calculation_Theory_Hist0.jpg"></p>
</li>
<li><p>What happens if we want to <em>count</em> this data in an organized way? Since we know that the <em>range</em><br>of information value for this case is 256 values, we can segment our range in subparts (called<br><strong>bins</strong>) like:</p>
<p>\f[\begin{array}{l}<br>[0, 255] &#x3D; { [0, 15] \cup [16, 31] \cup ….\cup [240,255] } \<br>range &#x3D; { bin_{1} \cup bin_{2} \cup ….\cup bin_{n &#x3D; 15} }<br>\end{array}\f]</p>
<p>and we can keep count of the number of pixels that fall in the range of each \f$bin_{i}\f$. Applying<br>this to the example above we get the image below ( axis x represents the bins and axis y the<br>number of pixels in each of them).</p>
<p><img src="/images/Histogram_Calculation_Theory_Hist1.jpg"></p>
</li>
<li><p>This was just a simple example of how an histogram works and why it is useful. An histogram can<br>keep count not only of color intensities, but of whatever image features that we want to measure<br>(i.e. gradients, directions, etc).</p>
</li>
<li><p>Let’s identify some parts of the histogram:<br>-#  <strong>dims</strong>: The number of parameters you want to collect data of. In our example, <strong>dims &#x3D; 1</strong><br>because we are only counting the intensity values of each pixel (in a greyscale image).<br>-#  <strong>bins</strong>: It is the number of <strong>subdivisions</strong> in each dim. In our example, <strong>bins &#x3D; 16</strong><br>-#  <strong>range</strong>: The limits for the values to be measured. In this case: <strong>range &#x3D; [0,255]</strong></p>
</li>
<li><p>What if you want to count two features? In this case your resulting histogram would be a 3D plot<br>(in which x and y would be \f$bin_{x}\f$ and \f$bin_{y}\f$ for each feature and z would be the number of<br>counts for each combination of \f$(bin_{x}, bin_{y})\f$. The same would apply for more features (of<br>course it gets trickier).</p>
</li>
</ul>
<h3 id="What-OpenCV-offers-you"><a href="#What-OpenCV-offers-you" class="headerlink" title="What OpenCV offers you"></a>What OpenCV offers you</h3><p>For simple purposes, OpenCV implements the function @ref cv::calcHist , which calculates the<br>histogram of a set of arrays (usually images or image planes). It can operate with up to 32<br>dimensions. We will see it in the code below!</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><ul>
<li><strong>What does this program do?</strong><ul>
<li>Loads an image</li>
<li>Splits the image into its R, G and B planes using the function @ref cv::split</li>
<li>Calculate the Histogram of each 1-channel plane by calling the function @ref cv::calcHist</li>
<li>Plot the three histograms in a window</li>
</ul>
</li>
</ul>
<p>@add_toggle_cpp</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/cpp/tutorial_code/Histograms_Matching/calcHist_Demo.cpp">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp<br>@end_toggle</p>
</li>
</ul>
<p>@add_toggle_java</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/java/tutorial_code/Histograms_Matching/histogram_calculation/CalcHistDemo.java">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java<br>@end_toggle</p>
</li>
</ul>
<p>@add_toggle_python</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/python/tutorial_code/Histograms_Matching/histogram_calculation/calcHist_Demo.py">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py<br>@end_toggle</p>
</li>
</ul>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><ul>
<li><p>Load the source image</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Load image<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Load image<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Load image<br>@end_toggle</p>
</li>
<li><p>Separate the source image in its three R,G and B planes. For this we use the OpenCV function<br>@ref cv::split :</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Separate the image in 3 places ( B, G and R )<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Separate the image in 3 places ( B, G and R )<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Separate the image in 3 places ( B, G and R )<br>@end_toggle<br>our input is the image to be divided (this case with three channels) and the output is a vector<br>of Mat )</p>
</li>
<li><p>Now we are ready to start configuring the <strong>histograms</strong> for each plane. Since we are working<br>with the B, G and R planes, we know that our values will range in the interval \f$[0,255]\f$</p>
</li>
<li><p>Establish the number of bins (5, 10…):</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Establish the number of bins<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Establish the number of bins<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Establish the number of bins<br>@end_toggle</p>
</li>
<li><p>Set the range of values (as we said, between 0 and 255 )</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Set the ranges ( for B,G,R) )<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Set the ranges ( for B,G,R) )<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Set the ranges ( for B,G,R) )<br>@end_toggle</p>
</li>
<li><p>We want our bins to have the same size (uniform) and to clear the histograms in the<br>beginning, so:</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Set histogram param<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Set histogram param<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Set histogram param<br>@end_toggle</p>
</li>
<li><p>We proceed to calculate the histograms by using the OpenCV function @ref cv::calcHist :</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Compute the histograms<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Compute the histograms<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Compute the histograms<br>@end_toggle</p>
</li>
<li><p>where the arguments are (<strong>C++ code</strong>):</p>
<ul>
<li><strong>&amp;bgr_planes[0]:</strong> The source array(s)</li>
<li><strong>1</strong>: The number of source arrays (in this case we are using 1. We can enter here also<br>a list of arrays )</li>
<li><strong>0</strong>: The channel (<em>dim</em>) to be measured. In this case it is just the intensity (each<br>array is single-channel) so we just write 0.</li>
<li><strong>Mat()</strong>: A mask to be used on the source array ( zeros indicating pixels to be ignored<br>). If not defined it is not used</li>
<li><strong>b_hist</strong>: The Mat object where the histogram will be stored</li>
<li><strong>1</strong>: The histogram dimensionality.</li>
<li><strong>histSize:</strong> The number of bins per each used dimension</li>
<li><strong>histRange:</strong> The range of values to be measured per each dimension</li>
<li><strong>uniform</strong> and <strong>accumulate</strong>: The bin sizes are the same and the histogram is cleared<br>at the beginning.</li>
</ul>
</li>
<li><p>Create an image to display the histograms:</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Draw the histograms for B, G and R<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Draw the histograms for B, G and R<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Draw the histograms for B, G and R<br>@end_toggle</p>
</li>
<li><p>Notice that before drawing, we first @ref cv::normalize the histogram so its values fall in the<br>range indicated by the parameters entered:</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Normalize the result to ( 0, histImage.rows )<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Normalize the result to ( 0, histImage.rows )<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Normalize the result to ( 0, histImage.rows )<br>@end_toggle</p>
</li>
<li><p>this function receives these arguments (<strong>C++ code</strong>):</p>
<ul>
<li><strong>b_hist:</strong> Input array</li>
<li><strong>b_hist:</strong> Output normalized array (can be the same)</li>
<li><strong>0</strong> and <strong>histImage.rows</strong>: For this example, they are the lower and upper limits to<br>normalize the values of <strong>r_hist</strong></li>
<li><strong>NORM_MINMAX:</strong> Argument that indicates the type of normalization (as described above, it<br>adjusts the values between the two limits set before)</li>
<li><strong>-1:</strong> Implies that the output normalized array will be the same type as the input</li>
<li><strong>Mat():</strong> Optional mask</li>
</ul>
</li>
<li><p>Observe that to access the bin (in this case in this 1D-Histogram):</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Draw for each channel<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Draw for each channel<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Draw for each channel<br>@end_toggle<br>we use the expression (<strong>C++ code</strong>):<br>@code{.cpp}<br>b_hist.at<float>(i)<br>@endcode<br>where \f$i\f$ indicates the dimension. If it were a 2D-histogram we would use something like:<br>@code{.cpp}<br>b_hist.at<float>( i, j )<br>@endcode</p>
</li>
<li><p>Finally we display our histograms and wait for the user to exit:</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;calcHist_Demo.cpp Display<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;CalcHistDemo.java Display<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;Histograms_Matching&#x2F;histogram_calculation&#x2F;calcHist_Demo.py Display<br>@end_toggle</p>
</li>
</ul>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>-#  Using as input argument an image like the one shown below:</p>
<pre><code>![](images/Histogram_Calculation_Original_Image.jpg)
</code></pre>
<p>-#  Produces the following histogram:</p>
<pre><code>![](images/Histogram_Calculation_Result.jpg)
</code></pre>
