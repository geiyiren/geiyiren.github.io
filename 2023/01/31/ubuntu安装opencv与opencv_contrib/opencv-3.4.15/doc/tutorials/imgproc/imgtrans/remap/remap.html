<h1 id="Remapping-tutorial-remap"><a href="#Remapping-tutorial-remap" class="headerlink" title="Remapping {#tutorial_remap}"></a>Remapping {#tutorial_remap}</h1><p>@prev_tutorial{tutorial_hough_circle}<br>@next_tutorial{tutorial_warp_affine}</p>
<h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>In this tutorial you will learn how to:</p>
<p>a.  Use the OpenCV function @ref cv::remap to implement simple remapping routines.</p>
<h2 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h2><h3 id="What-is-remapping"><a href="#What-is-remapping" class="headerlink" title="What is remapping?"></a>What is remapping?</h3><ul>
<li><p>It is the process of taking pixels from one place in the image and locating them in another<br>position in a new image.</p>
</li>
<li><p>To accomplish the mapping process, it might be necessary to do some interpolation for<br>non-integer pixel locations, since there will not always be a one-to-one-pixel correspondence<br>between source and destination images.</p>
</li>
<li><p>We can express the remap for every pixel location \f$(x,y)\f$ as:</p>
<p>\f[g(x,y) &#x3D; f ( h(x,y) )\f]</p>
<p>where \f$g()\f$ is the remapped image, \f$f()\f$ the source image and \f$h(x,y)\f$ is the mapping function<br>that operates on \f$(x,y)\f$.</p>
</li>
<li><p>Let’s think in a quick example. Imagine that we have an image \f$I\f$ and, say, we want to do a<br>remap such that:</p>
<p>\f[h(x,y) &#x3D; (I.cols - x, y )\f]</p>
<p>What would happen? It is easily seen that the image would flip in the \f$x\f$ direction. For<br>instance, consider the input image:</p>
<p><img src="/images/Remap_Tutorial_Theory_0.jpg"></p>
<p>observe how the red circle changes positions with respect to x (considering \f$x\f$ the horizontal<br>direction):</p>
<p><img src="/images/Remap_Tutorial_Theory_1.jpg"></p>
</li>
<li><p>In OpenCV, the function @ref cv::remap offers a simple remapping implementation.</p>
</li>
</ul>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><ul>
<li><strong>What does this program do?</strong><ul>
<li>Loads an image</li>
<li>Each second, apply 1 of 4 different remapping processes to the image and display them<br>indefinitely in a window.</li>
<li>Wait for the user to exit the program</li>
</ul>
</li>
</ul>
<p>@add_toggle_cpp</p>
<ul>
<li>The tutorial code’s is shown lines below. You can also download it from<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/cpp/tutorial_code/ImgTrans/Remap_Demo.cpp">here</a><br>@include samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;Remap_Demo.cpp<br>@end_toggle</li>
</ul>
<p>@add_toggle_java</p>
<ul>
<li>The tutorial code’s is shown lines below. You can also download it from<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/java/tutorial_code/ImgTrans/remap/RemapDemo.java">here</a><br>@include samples&#x2F;java&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;RemapDemo.java<br>@end_toggle</li>
</ul>
<p>@add_toggle_python</p>
<ul>
<li>The tutorial code’s is shown lines below. You can also download it from<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/python/tutorial_code/ImgTrans/remap/Remap_Demo.py">here</a><br>@include samples&#x2F;python&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;Remap_Demo.py<br>@end_toggle</li>
</ul>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><ul>
<li><p>Load an image:</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;Remap_Demo.cpp Load<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;RemapDemo.java Load<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;Remap_Demo.py Load<br>@end_toggle</p>
</li>
<li><p>Create the destination image and the two mapping matrices (for x and y )</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;Remap_Demo.cpp Create<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;RemapDemo.java Create<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;Remap_Demo.py Create<br>@end_toggle</p>
</li>
<li><p>Create a window to display results</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;Remap_Demo.cpp Window<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;RemapDemo.java Window<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;Remap_Demo.py Window<br>@end_toggle</p>
</li>
<li><p>Establish a loop. Each 1000 ms we update our mapping matrices (<em>mat_x</em> and <em>mat_y</em>) and apply<br>them to our source image:</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;Remap_Demo.cpp Loop<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;RemapDemo.java Loop<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;Remap_Demo.py Loop<br>@end_toggle</p>
</li>
<li><p>The function that applies the remapping is @ref cv::remap . We give the following arguments:</p>
<ul>
<li><strong>src</strong>: Source image</li>
<li><strong>dst</strong>: Destination image of same size as <em>src</em></li>
<li><strong>map_x</strong>: The mapping function in the x direction. It is equivalent to the first component<br>of \f$h(i,j)\f$</li>
<li><strong>map_y</strong>: Same as above, but in y direction. Note that <em>map_y</em> and <em>map_x</em> are both of<br>the same size as <em>src</em></li>
<li><strong>INTER_LINEAR</strong>: The type of interpolation to use for non-integer pixels. This is by<br>default.</li>
<li><strong>BORDER_CONSTANT</strong>: Default</li>
</ul>
<p>How do we update our mapping matrices <em>mat_x</em> and <em>mat_y</em>? Go on reading:</p>
</li>
<li><p><strong>Updating the mapping matrices:</strong> We are going to perform 4 different mappings:<br>-#  Reduce the picture to half its size and will display it in the middle:<br>\f[h(i,j) &#x3D; ( 2 \times i - src.cols&#x2F;2  + 0.5, 2 \times j - src.rows&#x2F;2  + 0.5)\f]<br>for all pairs \f$(i,j)\f$ such that: \f$\dfrac{src.cols}{4}&lt;i&lt;\dfrac{3 \cdot src.cols}{4}\f$ and<br>\f$\dfrac{src.rows}{4}&lt;j&lt;\dfrac{3 \cdot src.rows}{4}\f$<br>-#  Turn the image upside down: \f$h( i, j ) &#x3D; (i, src.rows - j)\f$<br>-#  Reflect the image from left to right: \f$h(i,j) &#x3D; ( src.cols - i, j )\f$<br>-#  Combination of b and c: \f$h(i,j) &#x3D; ( src.cols - i, src.rows - j )\f$</p>
</li>
</ul>
<p>This is expressed in the following snippet. Here, <em>map_x</em> represents the first coordinate of<br><em>h(i,j)</em> and <em>map_y</em> the second coordinate.</p>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;Remap_Demo.cpp Update<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;RemapDemo.java Update<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;ImgTrans&#x2F;remap&#x2F;Remap_Demo.py Update<br>@end_toggle</p>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>-#  After compiling the code above, you can execute it giving as argument an image path. For<br>    instance, by using the following image:</p>
<pre><code>![](images/Remap_Tutorial_Original_Image.jpg)
</code></pre>
<p>-#  This is the result of reducing it to half the size and centering it:</p>
<pre><code>![](images/Remap_Tutorial_Result_0.jpg)
</code></pre>
<p>-#  Turning it upside down:</p>
<pre><code>![](images/Remap_Tutorial_Result_1.jpg)
</code></pre>
<p>-#  Reflecting it in the x direction:</p>
<pre><code>![](images/Remap_Tutorial_Result_2.jpg)
</code></pre>
<p>-#  Reflecting it in both directions:</p>
<pre><code>![](images/Remap_Tutorial_Result_3.jpg)
</code></pre>
