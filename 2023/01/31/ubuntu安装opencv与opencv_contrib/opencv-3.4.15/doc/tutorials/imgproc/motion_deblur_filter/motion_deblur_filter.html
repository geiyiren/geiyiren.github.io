<h1 id="Motion-Deblur-Filter-tutorial-motion-deblur-filter"><a href="#Motion-Deblur-Filter-tutorial-motion-deblur-filter" class="headerlink" title="Motion Deblur Filter {#tutorial_motion_deblur_filter}"></a>Motion Deblur Filter {#tutorial_motion_deblur_filter}</h1><p>@prev_tutorial{tutorial_out_of_focus_deblur_filter}<br>@next_tutorial{tutorial_anisotropic_image_segmentation_by_a_gst}</p>
<h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>In this tutorial you will learn:</p>
<ul>
<li>what the PSF of a motion blur image is</li>
<li>how to restore a motion blur image</li>
</ul>
<h2 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h2><p>For the degradation image model theory and the Wiener filter theory you can refer to the tutorial @ref tutorial_out_of_focus_deblur_filter “Out-of-focus Deblur Filter”.<br>On this page only a linear motion blur distortion is considered. The motion blur image on this page is a real world image. The blur was caused by a moving subject.</p>
<h3 id="What-is-the-PSF-of-a-motion-blur-image"><a href="#What-is-the-PSF-of-a-motion-blur-image" class="headerlink" title="What is the PSF of a motion blur image?"></a>What is the PSF of a motion blur image?</h3><p>The point spread function (PSF) of a linear motion blur distortion is a line segment. Such a PSF is specified by two parameters: \f$LEN\f$ is the length of the blur and \f$THETA\f$ is the angle of motion.</p>
<p><img src="/images/motion_psf.png" alt="Point spread function of a linear motion blur distortion"></p>
<h3 id="How-to-restore-a-blurred-image"><a href="#How-to-restore-a-blurred-image" class="headerlink" title="How to restore a blurred image?"></a>How to restore a blurred image?</h3><p>On this page the Wiener filter is used as the restoration filter, for details you can refer to the tutorial @ref tutorial_out_of_focus_deblur_filter “Out-of-focus Deblur Filter”.<br>In order to synthesize the Wiener filter for a motion blur case, it needs to specify the signal-to-noise ratio (\f$SNR\f$), \f$LEN\f$ and \f$THETA\f$ of the PSF.</p>
<h2 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h2><p>You can find source code in the <code>samples/cpp/tutorial_code/ImgProc/motion_deblur_filter/motion_deblur_filter.cpp</code> of the OpenCV source code library.</p>
<p>@include cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;motion_deblur_filter&#x2F;motion_deblur_filter.cpp</p>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>A motion blur image recovering algorithm consists of PSF generation, Wiener filter generation and filtering a blurred image in a frequency domain:<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;motion_deblur_filter&#x2F;motion_deblur_filter.cpp main</p>
<p>A function calcPSF() forms a PSF according to input parameters \f$LEN\f$ and \f$THETA\f$ (in degrees):<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;motion_deblur_filter&#x2F;motion_deblur_filter.cpp calcPSF</p>
<p>A function edgetaper() tapers the input image’s edges in order to reduce the ringing effect in a restored image:<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;ImgProc&#x2F;motion_deblur_filter&#x2F;motion_deblur_filter.cpp edgetaper</p>
<p>The functions calcWnrFilter(), fftshift() and filter2DFreq() realize an image filtration by a specified PSF in the frequency domain.  The functions are copied from the tutorial<br>@ref tutorial_out_of_focus_deblur_filter “Out-of-focus Deblur Filter”.</p>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>Below you can see the real world image with motion blur distortion. The license plate is not readable on both cars. The red markers show the car’s license plate location.<br><img src="/images/motion_original.jpg" alt="Motion blur image. The license plates are not readable"></p>
<p>Below you can see the restoration result for the black car license plate. The result has been computed with \f$LEN\f$ &#x3D; 125, \f$THETA\f$ &#x3D; 0, \f$SNR\f$ &#x3D; 700.<br><img src="/images/black_car.jpg" alt="The restored image of the black car license plate"></p>
<p>Below you can see the restoration result for the white car license plate. The result has been computed with \f$LEN\f$ &#x3D; 78, \f$THETA\f$ &#x3D; 15, \f$SNR\f$ &#x3D; 300.<br><img src="/images/white_car.jpg" alt="The restored image of the white car license plate"></p>
<p>The values of \f$SNR\f$, \f$LEN\f$ and \f$THETA\f$ were selected manually to give the best possible visual result. The \f$THETA\f$ parameter coincides with the car’s moving direction, and the<br>\f$LEN\f$ parameter depends on the car’s moving speed.<br>The result is not perfect, but at least it gives us a hint of the image’s content. With some effort, the car license plate is now readable.</p>
<p>@note The parameters \f$LEN\f$ and \f$THETA\f$ are the most important. You should adjust \f$LEN\f$ and \f$THETA\f$ first, then \f$SNR\f$.</p>
<p>You can also find a quick video demonstration of a license plate recovering method<br><a href="https://youtu.be/xSrE0hdhb4o">YouTube</a>.<br>@youtube{xSrE0hdhb4o}</p>
