<h1 id="Introduction-to-Java-Development-tutorial-java-dev-intro"><a href="#Introduction-to-Java-Development-tutorial-java-dev-intro" class="headerlink" title="Introduction to Java Development {#tutorial_java_dev_intro}"></a>Introduction to Java Development {#tutorial_java_dev_intro}</h1><p>@prev_tutorial{tutorial_windows_visual_studio_image_watch}<br>@next_tutorial{tutorial_java_eclipse}</p>
<p>As of OpenCV 2.4.4, OpenCV supports desktop Java development using nearly the same interface as for<br>Android development. This guide will help you to create your first Java (or Scala) application using<br>OpenCV. We will use either <a href="http://ant.apache.org/">Apache Ant</a> or <a href="http://www.scala-sbt.org/">Simple Build Tool<br>(SBT)</a> to build the application.</p>
<p>If you want to use Eclipse head to @ref tutorial_java_eclipse. For further reading after this guide, look at<br>the @ref tutorial_android_dev_intro tutorials.</p>
<h2 id="What-we’ll-do-in-this-guide"><a href="#What-we’ll-do-in-this-guide" class="headerlink" title="What we’ll do in this guide"></a>What we’ll do in this guide</h2><p>In this guide, we will:</p>
<ul>
<li>Get OpenCV with desktop Java support</li>
<li>Create an Ant or SBT project</li>
<li>Write a simple OpenCV application in Java or Scala</li>
</ul>
<p>The same process was used to create the samples in the <code>samples/java</code> folder of the OpenCV<br>repository, so consult those files if you get lost.</p>
<h2 id="Get-proper-OpenCV"><a href="#Get-proper-OpenCV" class="headerlink" title="Get proper OpenCV"></a>Get proper OpenCV</h2><p>Starting from version 2.4.4 OpenCV includes desktop Java bindings.</p>
<h3 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h3><p>The most simple way to get it is downloading the appropriate package of <strong>version 2.4.4 or higher</strong><br>from the <a href="http://sourceforge.net/projects/opencvlibrary/files/">OpenCV SourceForge repository</a>.</p>
<p>@note Windows users can find the prebuilt files needed for Java development in the<br><code>opencv/build/java/</code> folder inside the package. For other OSes it’s required to build OpenCV from<br>sources.</p>
<p>Another option to get OpenCV sources is to clone <a href="https://github.com/opencv/opencv/">OpenCV git<br>repository</a>. In order to build OpenCV with Java bindings you need<br>JDK (Java Development Kit) (we recommend <a href="http://www.oracle.com/technetwork/java/javase/downloads/">Oracle&#x2F;Sun JDK 6 or<br>7</a>), <a href="http://ant.apache.org/">Apache Ant</a><br>and Python v2.6 or higher to be installed.</p>
<h3 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h3><p>Let’s build OpenCV:<br>@code{.bash}<br>git clone git:&#x2F;&#x2F;github.com&#x2F;opencv&#x2F;opencv.git<br>cd opencv<br>git checkout 2.4<br>mkdir build<br>cd build<br>@endcode<br>Generate a Makefile or a MS Visual Studio* solution, or whatever you use for building executables<br>in your system:<br>@code{.bash}<br>cmake -DBUILD_SHARED_LIBS&#x3D;OFF ..<br>@endcode<br>or<br>@code{.bat}<br>cmake -DBUILD_SHARED_LIBS&#x3D;OFF -G “Visual Studio 10” ..<br>@endcode</p>
<p>@note When OpenCV is built as a set of <strong>static</strong> libraries (-DBUILD_SHARED_LIBS&#x3D;OFF option) the<br>Java bindings dynamic library is all-sufficient, i.e. doesn’t depend on other OpenCV libs, but<br>includes all the OpenCV code inside.</p>
<p>Examine the output of CMake and ensure java is one of the<br>modules “To be built”. If not, it’s likely you’re missing a dependency. You should troubleshoot by<br>looking through the CMake output for any Java-related tools that aren’t found and installing them.</p>
<p><img src="/images/cmake_output.png"></p>
<p>@note If CMake can’t find Java in your system set the JAVA_HOME environment variable with the path to installed JDK before running it. E.g.:<br>@code{.bash}<br>export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-6-oracle<br>cmake -DBUILD_SHARED_LIBS&#x3D;OFF ..<br>@endcode</p>
<p>Now start the build:<br>@code{.bash}<br>make -j8<br>@endcode<br>or<br>@code{.bat}<br>msbuild &#x2F;m OpenCV.sln &#x2F;t:Build &#x2F;p:Configuration&#x3D;Release &#x2F;v:m<br>@endcode<br>Besides all this will create a jar containing the Java interface (<code>bin/opencv-244.jar</code>) and a native<br>dynamic library containing Java bindings and all the OpenCV stuff (<code>lib/libopencv_java244.so</code> or<br><code>bin/Release/opencv_java244.dll</code> respectively). We’ll use these files later.</p>
<h2 id="Java-sample-with-Ant"><a href="#Java-sample-with-Ant" class="headerlink" title="Java sample with Ant"></a>Java sample with Ant</h2><p>@note The described sample is provided with OpenCV library in the <code>opencv/samples/java/ant</code><br>folder.</p>
<ul>
<li><p>Create a folder where you’ll develop this sample application.</p>
</li>
<li><p>In this folder create the <code>build.xml</code> file with the following content using any text editor:<br>@include samples&#x2F;java&#x2F;ant&#x2F;build.xml<br>@note This XML file can be reused for building other Java applications. It describes a common folder structure in the lines 3 - 12 and common targets for compiling and running the application.<br>When reusing this XML don’t forget to modify the project name in the line 1, that is also the<br>name of the main class (line 14). The paths to OpenCV jar and jni lib are expected as parameters<br>(“${ocvJarDir}” in line 5 and “${ocvLibDir}” in line 37), but you can hardcode these paths for<br>your convenience. See <a href="http://ant.apache.org/manual/">Ant documentation</a> for detailed<br>description of its build file format.</p>
</li>
<li><p>Create an <code>src</code> folder next to the <code>build.xml</code> file and a <code>SimpleSample.java</code> file in it.</p>
</li>
<li><p>Put the following Java code into the <code>SimpleSample.java</code> file:<br>@code{.java}<br>import org.opencv.core.Core;<br>import org.opencv.core.Mat;<br>import org.opencv.core.CvType;<br>import org.opencv.core.Scalar;<br><br>class SimpleSample {<br><br>  static{ System.loadLibrary(Core.NATIVE_LIBRARY_NAME); }<br><br>  public static void main(String[] args) {<br>    System.out.println(“Welcome to OpenCV “ + Core.VERSION);<br>    Mat m &#x3D; new Mat(5, 10, CvType.CV_8UC1, new Scalar(0));<br>    System.out.println(“OpenCV Mat: “ + m);<br>    Mat mr1 &#x3D; m.row(1);<br>    mr1.setTo(new Scalar(1));<br>    Mat mc5 &#x3D; m.col(5);<br>    mc5.setTo(new Scalar(5));<br>    System.out.println(“OpenCV Mat data:\n” + m.dump());<br>  }<br><br>}<br>@endcode</p>
</li>
<li><p>Run the following command in console in the folder containing <code>build.xml</code>:<br>@code{.bash}<br>ant -DocvJarDir&#x3D;path&#x2F;to&#x2F;dir&#x2F;containing&#x2F;opencv-244.jar -DocvLibDir&#x3D;path&#x2F;to&#x2F;dir&#x2F;containing&#x2F;opencv_java244&#x2F;native&#x2F;library<br>@endcode<br>For example:<br>@code{.bat}<br>ant -DocvJarDir&#x3D;X:\opencv-2.4.4\bin -DocvLibDir&#x3D;X:\opencv-2.4.4\bin\Release<br>@endcode<br>The command should initiate [re]building and running the sample. You should see on the<br>screen something like this:</p>
<p><img src="/images/ant_output.png"></p>
</li>
</ul>
<h2 id="SBT-project-for-Java-and-Scala"><a href="#SBT-project-for-Java-and-Scala" class="headerlink" title="SBT project for Java and Scala"></a>SBT project for Java and Scala</h2><p>Now we’ll create a simple Java application using SBT. This serves as a brief introduction to those<br>unfamiliar with this build tool. We’re using SBT because it is particularly easy and powerful.</p>
<p>First, download and install <a href="http://www.scala-sbt.org/">SBT</a> using the instructions on its <a href="http://www.scala-sbt.org/">web<br>site</a>.</p>
<p>Next, navigate to a new directory where you’d like the application source to live (outside <code>opencv</code><br>dir). Let’s call it “JavaSample” and create a directory for it:<br>@code{.bash}<br>cd <somewhere outside opencv><br>mkdir JavaSample<br>@endcode<br>Now we will create the necessary folders and an SBT project:<br>@code{.bash}<br>cd JavaSample<br>mkdir -p src&#x2F;main&#x2F;java # This is where SBT expects to find Java sources<br>mkdir project # This is where the build definitions live<br>@endcode<br>Now open <code>project/build.scala</code> in your favorite editor and paste the following. It defines your<br>project:<br>@code{.scala}<br>import sbt._<br>import Keys._</p>
<p>object JavaSampleBuild extends Build {<br>  def scalaSettings &#x3D; Seq(<br>    scalaVersion :&#x3D; “2.10.0”,<br>    scalacOptions ++&#x3D; Seq(<br>      “-optimize”,<br>      “-unchecked”,<br>      “-deprecation”<br>    )<br>  )</p>
<p>  def buildSettings &#x3D;<br>    Project.defaultSettings ++<br>    scalaSettings</p>
<p>  lazy val root &#x3D; {<br>    val settings &#x3D; buildSettings ++ Seq(name :&#x3D; “JavaSample”)<br>    Project(id &#x3D; “JavaSample”, base &#x3D; file(“.”), settings &#x3D; settings)<br>  }<br>}<br>@endcode<br>Now edit <code>project/plugins.sbt</code> and paste the following. This will enable auto-generation of an<br>Eclipse project:<br>@code{.scala}<br>addSbtPlugin(“com.typesafe.sbteclipse” % “sbteclipse-plugin” % “2.1.0”)<br>@endcode<br>Now run sbt from the <code>JavaSample</code> root and from within SBT run eclipse to generate an eclipse<br>project:<br>@code{.bash}<br>sbt # Starts the sbt console<br>eclipse # Running “eclipse” from within the sbt console<br>@endcode<br>You should see something like this:</p>
<p><img src="/images/sbt_eclipse.png"></p>
<p>You can now import the SBT project to Eclipse using Import … -&gt; Existing projects into workspace.<br>Whether you actually do this is optional for the guide; we’ll be using SBT to build the project, so<br>if you choose to use Eclipse it will just serve as a text editor.</p>
<p>To test that everything is working, create a simple “Hello OpenCV” application. Do this by creating<br>a file <code>src/main/java/HelloOpenCV.java</code> with the following contents:<br>@code{.java}<br>public class HelloOpenCV {<br>  public static void main(String[] args) {<br>    System.out.println(“Hello, OpenCV”);<br> }<br>@endcode<br>}</p>
<p>Now execute run from the sbt console, or more concisely, run sbt run from the command line:<br>@code{.bash}<br>sbt run<br>@endcode<br>You should see something like this:</p>
<p><img src="/images/sbt_run.png"></p>
<h3 id="Running-SBT-samples"><a href="#Running-SBT-samples" class="headerlink" title="Running SBT samples"></a>Running SBT samples</h3><p>Now we’ll create a simple face detection application using OpenCV.</p>
<p>First, create a <code>lib/</code> folder and copy the OpenCV jar into it. By default, SBT adds jars in the lib<br>folder to the Java library search path. You can optionally rerun sbt eclipse to update your Eclipse<br>project.<br>@code{.bash}<br>mkdir lib<br>cp <opencv_dir>&#x2F;build&#x2F;bin&#x2F;opencv_<version>.jar lib&#x2F;<br>sbt eclipse<br>@endcode<br>Next, create the directory <code>src/main/resources</code> and download this Lena image into it:</p>
<p><img src="/images/lena.png"></p>
<p>Make sure it’s called <code>&quot;lena.png&quot;</code>. Items in the resources directory are available to the Java<br>application at runtime.</p>
<p>Next, copy <code>lbpcascade_frontalface.xml</code> from <code>opencv/data/lbpcascades/</code> into the <code>resources</code><br>directory:<br>@code{.bash}<br>cp <opencv_dir>&#x2F;data&#x2F;lbpcascades&#x2F;lbpcascade_frontalface.xml src&#x2F;main&#x2F;resources&#x2F;<br>@endcode<br>Now modify src&#x2F;main&#x2F;java&#x2F;HelloOpenCV.java so it contains the following Java code:<br>@code{.java}<br>import org.opencv.core.Core;<br>import org.opencv.core.Mat;<br>import org.opencv.core.MatOfRect;<br>import org.opencv.core.Point;<br>import org.opencv.core.Rect;<br>import org.opencv.core.Scalar;<br>import org.opencv.imgcodecs.Imgcodecs;<br>import org.opencv.objdetect.CascadeClassifier;</p>
<p>&#x2F;&#x2F;<br>&#x2F;&#x2F; Detects faces in an image, draws boxes around them, and writes the results<br>&#x2F;&#x2F; to “faceDetection.png”.<br>&#x2F;&#x2F;<br>class DetectFaceDemo {<br>  public void run() {<br>    System.out.println(“\nRunning DetectFaceDemo”);</p>
<pre><code>// Create a face detector from the cascade file in the resources
// directory.
CascadeClassifier faceDetector = new CascadeClassifier(getClass().getResource(&quot;/lbpcascade_frontalface.xml&quot;).getPath());
Mat image = Imgcodecs.imread(getClass().getResource(&quot;/lena.png&quot;).getPath());

// Detect faces in the image.
// MatOfRect is a special container class for Rect.
MatOfRect faceDetections = new MatOfRect();
faceDetector.detectMultiScale(image, faceDetections);

System.out.println(String.format(&quot;Detected %s faces&quot;, faceDetections.toArray().length));

// Draw a bounding box around each face.
for (Rect rect : faceDetections.toArray()) {
    Imgproc.rectangle(image, new Point(rect.x, rect.y), new Point(rect.x + rect.width, rect.y + rect.height), new Scalar(0, 255, 0));
}

// Save the visualized detection.
String filename = &quot;faceDetection.png&quot;;
System.out.println(String.format(&quot;Writing %s&quot;, filename));
Imgcodecs.imwrite(filename, image);
</code></pre>
<p>  }<br>}</p>
<p>public class HelloOpenCV {<br>  public static void main(String[] args) {<br>    System.out.println(“Hello, OpenCV”);</p>
<pre><code>// Load the native library.
System.loadLibrary(Core.NATIVE_LIBRARY_NAME);
new DetectFaceDemo().run();
</code></pre>
<p>  }<br>}<br>@endcode<br>Note the call to System.loadLibrary(Core.NATIVE_LIBRARY_NAME). This command must be executed<br>exactly once per Java process prior to using any native OpenCV methods. If you don’t call it, you<br>will get UnsatisfiedLink errors. You will also get errors if you try to load OpenCV when it has<br>already been loaded.</p>
<p>Now run the face detection app using `sbt run`:<br>@code{.bash}<br>sbt run<br>@endcode<br>You should see something like this:</p>
<p><img src="/images/sbt_run_face.png"></p>
<p>It should also write the following image to <code>faceDetection.png</code>:</p>
<p><img src="/images/faceDetection.png"></p>
<p>You’re done! Now you have a sample Java application working with OpenCV, so you can start the work<br>on your own. We wish you good luck and many years of joyful life!</p>
