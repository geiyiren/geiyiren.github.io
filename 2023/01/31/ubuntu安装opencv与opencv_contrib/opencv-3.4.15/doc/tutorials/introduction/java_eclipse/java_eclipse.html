<h1 id="Using-OpenCV-Java-with-Eclipse-tutorial-java-eclipse"><a href="#Using-OpenCV-Java-with-Eclipse-tutorial-java-eclipse" class="headerlink" title="Using OpenCV Java with Eclipse {#tutorial_java_eclipse}"></a>Using OpenCV Java with Eclipse {#tutorial_java_eclipse}</h1><p>@prev_tutorial{tutorial_java_dev_intro}<br>@next_tutorial{tutorial_clojure_dev_intro}</p>
<p>Since version 2.4.4 <a href="http://opencv.org/opencv-java-api.html">OpenCV supports Java</a>. In this tutorial<br>I will explain how to setup development environment for using OpenCV Java with Eclipse in<br><strong>Windows</strong>, so you can enjoy the benefits of garbage collected, very refactorable (rename variable,<br>extract method and whatnot) modern language that enables you to write code with less effort and make<br>less mistakes. Here we go.</p>
<h2 id="Configuring-Eclipse"><a href="#Configuring-Eclipse" class="headerlink" title="Configuring Eclipse"></a>Configuring Eclipse</h2><p>First, obtain a fresh release of OpenCV <a href="http://opencv.org/releases.html">from download page</a> and<br>extract it under a simple location like <code>C:\OpenCV-2.4.6\</code>. I am using version 2.4.6, but the steps<br>are more or less the same for other versions.</p>
<p>Now, we will define OpenCV as a user library in Eclipse, so we can reuse the configuration for any<br>project. Launch Eclipse and select Window –&gt; Preferences from the menu.</p>
<p><img src="/images/1-window-preferences.png"></p>
<p>Navigate under Java –&gt; Build Path –&gt; User Libraries and click New….</p>
<p><img src="/images/2-user-library-new.png"></p>
<p>Enter a name, e.g. OpenCV-2.4.6, for your new library.</p>
<p><img src="/images/3-library-name.png"></p>
<p>Now select your new user library and click Add External JARs….</p>
<p><img src="/images/4-add-external-jars.png"></p>
<p>Browse through <code>C:\OpenCV-2.4.6\build\java\</code> and select opencv-246.jar. After adding the jar,<br>extend the opencv-246.jar and select Native library location and press Edit….</p>
<p><img src="/images/5-native-library.png"></p>
<p>Select External Folder… and browse to select the folder <code>C:\OpenCV-2.4.6\build\java\x64</code>. If you<br>have a 32-bit system you need to select the x86 folder instead of x64.</p>
<p><img src="/images/6-external-folder.png"></p>
<p>Your user library configuration should look like this:</p>
<p><img src="/images/7-user-library-final.png"></p>
<h2 id="Testing-the-configuration-on-a-new-Java-project"><a href="#Testing-the-configuration-on-a-new-Java-project" class="headerlink" title="Testing the configuration on a new Java project"></a>Testing the configuration on a new Java project</h2><p>Now start creating a new Java project.</p>
<p><img src="/images/7_5-new-java-project.png"></p>
<p>On the Java Settings step, under Libraries tab, select Add Library… and select OpenCV-2.4.6, then<br>click Finish.</p>
<p><img src="/images/8-add-library.png"></p>
<p><img src="/images/9-select-user-lib.png"></p>
<p>Libraries should look like this:</p>
<p><img src="/images/10-new-project-created.png"></p>
<p>Now you have created and configured a new Java project it is time to test it. Create a new java<br>file. Here is a starter code for your convenience:<br>@code{.java}<br>import org.opencv.core.Core;<br>import org.opencv.core.CvType;<br>import org.opencv.core.Mat;</p>
<p>public class Hello<br>{<br>   public static void main( String[] args )<br>   {<br>      System.loadLibrary( Core.NATIVE_LIBRARY_NAME );<br>      Mat mat &#x3D; Mat.eye( 3, 3, CvType.CV_8UC1 );<br>      System.out.println( “mat &#x3D; “ + mat.dump() );<br>   }<br>}<br>@endcode<br>When you run the code you should see 3x3 identity matrix as output.</p>
<p><img src="/images/11-the-code.png"></p>
<p>That is it, whenever you start a new project just add the OpenCV user library that you have defined<br>to your project and you are good to go. Enjoy your powerful, less painful development environment :)</p>
<h2 id="Running-Java-code-with-OpenCV-and-MKL-dependency"><a href="#Running-Java-code-with-OpenCV-and-MKL-dependency" class="headerlink" title="Running Java code with OpenCV and MKL dependency"></a>Running Java code with OpenCV and MKL dependency</h2><p>You may get the following error (e.g. on Ubuntu) if you have built OpenCV with MKL library with some Java code that calls OpenCV functions<br>that use Intel MKL:</p>
<blockquote>
<p>Intel MKL FATAL ERROR: Cannot load libmkl_avx2.so or libmkl_def.so.</p>
</blockquote>
<p>One solution to solve this on Linux consists in preloading the Intel MKL library (either run the command in a terminal or add it to your <code>.bashrc</code> file).<br>Your command line should be something similar to this (add <code>$LD_PRELOAD:</code> before if you have already set the <code>LD_PRELOAD</code> variable):</p>
<blockquote>
<p>export LD_PRELOAD&#x3D;&#x2F;opt&#x2F;intel&#x2F;mkl&#x2F;lib&#x2F;intel64&#x2F;libmkl_core.so:&#x2F;opt&#x2F;intel&#x2F;mkl&#x2F;lib&#x2F;intel64&#x2F;libmkl_sequential.so</p>
</blockquote>
<p>Then, run the Eclipse IDE from a terminal that have this environment variable set (<code>echo $LD_PRELOAD</code>) and the error should disappear.</p>
