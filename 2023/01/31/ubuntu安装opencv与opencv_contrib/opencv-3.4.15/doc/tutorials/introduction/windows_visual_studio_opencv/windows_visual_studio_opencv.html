<h1 id="How-to-build-applications-with-OpenCV-inside-the-“Microsoft-Visual-Studio”-tutorial-windows-visual-studio-opencv"><a href="#How-to-build-applications-with-OpenCV-inside-the-“Microsoft-Visual-Studio”-tutorial-windows-visual-studio-opencv" class="headerlink" title="How to build applications with OpenCV inside the “Microsoft Visual Studio” {#tutorial_windows_visual_studio_opencv}"></a>How to build applications with OpenCV inside the “Microsoft Visual Studio” {#tutorial_windows_visual_studio_opencv}</h1><p>@prev_tutorial{tutorial_windows_install}<br>@next_tutorial{tutorial_windows_visual_studio_image_watch}</p>
<p>Everything I describe here will apply to the <code>C\C++</code> interface of OpenCV. I start out from the<br>assumption that you have read and completed with success the @ref tutorial_windows_install tutorial.<br>Therefore, before you go any further make sure you have an OpenCV directory that contains the OpenCV<br>header files plus binaries and you have set the environment variables as described here<br>@ref tutorial_windows_install_path.</p>
<p><img src="/images/OpenCV_Install_Directory.jpg"></p>
<p>The OpenCV libraries, distributed by us, on the Microsoft Windows operating system are in a<br>Dynamic Linked Libraries (<em>DLL</em>). These have the advantage that all the content of the<br>library is loaded only at runtime, on demand, and that countless programs may use the same library<br>file. This means that if you have ten applications using the OpenCV library, no need to have around<br>a version for each one of them. Of course you need to have the <em>dll</em> of the OpenCV on all systems<br>where you want to run your application.</p>
<p>Another approach is to use static libraries that have <em>lib</em> extensions. You may build these by using<br>our source files as described in the @ref tutorial_windows_install tutorial. When you use this the<br>library will be built-in inside your <em>exe</em> file. So there is no chance that the user deletes them,<br>for some reason. As a drawback your application will be larger one and as, it will take more time to<br>load it during its startup.</p>
<p>To build an application with OpenCV you need to do two things:</p>
<ul>
<li><p><em>Tell</em> to the compiler how the OpenCV library <em>looks</em>. You do this by <em>showing</em> it the header<br>files.</p>
</li>
<li><p><em>Tell</em> to the linker from where to get the functions or data structures of OpenCV, when they are<br>needed.</p>
<p>If you use the <em>lib</em> system you must set the path where the library files are and specify in<br>which one of them to look. During the build the linker will look into these libraries and add<br>the definitions and implementation of all <em>used</em> functions and data structures to the executable<br>file.</p>
<p>If you use the <em>DLL</em> system you must again specify all this, however now for a different reason.<br>This is a Microsoft OS specific stuff. It seems that the linker needs to know that where in the<br>DLL to search for the data structure or function at the runtime. This information is stored<br>inside <em>lib</em> files. Nevertheless, they aren’t static libraries. They are so called import<br>libraries. This is why when you make some <em>DLLs</em> in Windows you will also end up with some <em>lib</em><br>extension libraries. The good part is that at runtime only the <em>DLL</em> is required.</p>
</li>
</ul>
<p>To pass on all this information to the Visual Studio IDE you can either do it globally (so all your<br>future projects will get this information) or locally (so only for you current project). The<br>advantage of the global one is that you only need to do it once; however, it may be undesirable to<br>clump all your projects all the time with all this information. In case of the global one how you<br>do it depends on the Microsoft Visual Studio you use. There is a <strong>2008 and previous versions</strong> and<br>a <strong>2010 way</strong> of doing it. Inside the global section of this tutorial I’ll show what the main<br>differences are.</p>
<p>The base item of a project in Visual Studio is a solution. A solution may contain multiple projects.<br>Projects are the building blocks of an application. Every project will realize something and you<br>will have a main project in which you can put together this project puzzle. In case of the many<br>simple applications (like many of the tutorials will be) you do not need to break down the<br>application into modules. In these cases, your main project will be the only existing one. Now go<br>create a new solution inside Visual studio by going through the File –&gt; New –&gt; Project menu<br>selection. Choose <em>Win32 Console Application</em> as type. Enter its name and select the path where to<br>create it. Then in the upcoming dialog make sure you create an empty project.</p>
<p><img src="/images/NewProjectVisualStudio.jpg"></p>
<h2 id="The-local-method"><a href="#The-local-method" class="headerlink" title="The local method"></a>The <em>local</em> method</h2><p>Every project is built separately from the others. Due to this every project has its own rule<br>package. Inside this rule packages are stored all the information the <em>IDE</em> needs to know to build<br>your project. For any application there are at least two build modes: a <em>Release</em> and a <em>Debug</em> one.<br>The <em>Debug</em> has many features that exist so you can find and resolve easier bugs inside your<br>application. In contrast the <em>Release</em> is an optimized version, where the goal is to make the<br>application run as fast as possible or to be as small as possible. You may figure that these modes<br>also require different rules to use during build. Therefore, there exist different rule packages for<br>each of your build modes. These rule packages are called inside the IDE as <em>project properties</em> and<br>you can view and modify them by using the <em>Property Manager</em>. You can bring this up with<br>View –&gt; Property Pages (For Visual Studio 2013 onwards, go to View –&gt; Other Windows –&gt; Property Manager).<br>Expand it and you can see the existing rule packages (called <em>Property Sheets</em>).</p>
<p><img src="/images/PropertyPageExample.jpg"></p>
<p>The really useful stuff of these is that you may create a rule package <em>once</em> and you can later just<br>add it to your new projects. Create it once and reuse it later. We want to create a new <em>Property<br>Sheet</em> that will contain all the rules that the compiler and linker needs to know. Of course we will<br>need a separate one for the Debug and the Release Builds. Start up with the Debug one as shown in<br>the image below:</p>
<p><img src="/images/AddNewPropertySheet.jpg"></p>
<p>Use for example the <em>OpenCV_Debug</em> name. Then by selecting the sheet Right Click –&gt; Properties.<br>In the following I will show to set the OpenCV rules locally, as I find unnecessary to pollute<br>projects with custom rules that I do not use it. Go the C++ groups General entry and under the<br><em>“Additional Include Directories”</em> add the path to your OpenCV include. If you don’t have <em>“C&#x2F;C++”</em><br>group, you should add any .c&#x2F;.cpp file to the project.<br>@code{.bash}<br>$(OPENCV_DIR)....\include<br>@endcode<br><img src="/images/PropertySheetOpenCVInclude.jpg"></p>
<p>When adding third party libraries settings it is generally a good idea to use the power behind the<br>environment variables. The full location of the OpenCV library may change on each system. Moreover,<br>you may even end up yourself with moving the install directory for some reason. If you would give<br>explicit paths inside your property sheet your project will end up not working when you pass it<br>further to someone else who has a different OpenCV install path. Moreover, fixing this would require<br>to manually modifying every explicit path. A more elegant solution is to use the environment<br>variables. Anything that you put inside a parenthesis started with a dollar sign will be replaced at<br>runtime with the current environment variables value. Here comes in play the environment variable<br>setting we already made in our previous tutorial @ref tutorial_windows_install_path.</p>
<p>Next go to the Linker –&gt; General and under the <em>“Additional Library Directories”</em> add the libs<br>directory:<br>@code{.bash}<br>$(OPENCV_DIR)\lib<br>@endcode</p>
<p><img src="/images/PropertySheetOpenCVLib.jpg"></p>
<p>Then you need to specify the libraries in which the linker should look into. To do this go to the<br>Linker –&gt; Input and under the <em>“Additional Dependencies”</em> entry add the name of all modules which<br>you want to use:</p>
<p><img src="/images/PropertySheetOpenCVLibrariesDebugSmple.jpg"></p>
<p><img src="/images/PropertySheetOpenCVLibrariesDebug.jpg"></p>
<p>The names of the libraries are as follow:<br>@code{.bash}<br>opencv_(The Name of the module)(The version Number of the library you use)d.lib<br>@endcode<br>A full list, for the latest version would contain:<br>@code{.bash}<br>opencv_calib3d300d.lib<br>opencv_core300d.lib<br>opencv_features2d300d.lib<br>opencv_flann300d.lib<br>opencv_highgui300d.lib<br>opencv_imgcodecs300d.lib<br>opencv_imgproc300d.lib<br>opencv_ml300d.lib<br>opencv_objdetect300d.lib<br>opencv_photo300d.lib<br>opencv_shape300d.lib<br>opencv_stitching300d.lib<br>opencv_superres300d.lib<br>opencv_ts300d.lib<br>opencv_video300d.lib<br>opencv_videoio300d.lib<br>opencv_videostab300d.lib<br>@endcode</p>
<p>Alternatively, your OpenCV download may have been built into one large .lib file. Check by looking in OpenCV\build\architecture\vc14\lib. In this case all you would add is, for the version 3.3.0:<br>@code{.bash}<br>opencv_world330.lib<br>@endcode<br>The letter <em>d</em> at the end just indicates that these are the libraries required for the debug. Now<br>click ok to save and do the same with a new property inside the Release rule section. Make sure to<br>omit the <em>d</em> letters from the library names and to save the property sheets with the save icon above<br>them.</p>
<p><img src="/images/PropertySheetOpenCVLibrariesRelease.jpg"></p>
<p>You can find your property sheets inside your projects directory. At this point, it is a wise<br>decision to back them up into some special directory, to always have them at hand in the future,<br>whenever you create an OpenCV project. Note that for Visual Studio 2010 the file extension is<br><em>props</em>, while for 2008 this is <em>vsprops</em>.</p>
<p><img src="/images/PropertySheetInsideFolder.jpg"></p>
<p>Next time when you make a new OpenCV project just use the “Add Existing Property Sheet…” menu<br>entry inside the Property Manager to easily add the OpenCV build rules.</p>
<p><img src="/images/PropertyPageAddExisting.jpg"></p>
<h2 id="The-global-method"><a href="#The-global-method" class="headerlink" title="The global method"></a>The <em>global</em> method</h2><p>In case you find it too troublesome to add the property pages to each and every one of your projects you<br>can also add this rules to a <em>“global property page”</em>. However, this applies only to the additional<br>include and library directories. The name of the libraries to use you still need to specify manually<br>by using for instance: a Property page.</p>
<p>In Visual Studio 2008 you can find this under the:<br>Tools –&gt; Options –&gt; Projects and Solutions –&gt; VC++ Directories.</p>
<p><img src="/images/VCDirectories2008.jpg"></p>
<p>In Visual Studio 2010 this has been moved to a global property sheet which is automatically added to<br>every project you create:</p>
<p><img src="/images/VCDirectories2010.jpg"></p>
<p>The process is the same as described in case of the local approach. Just add the include directories<br>by using the environment variable <em>OPENCV_DIR</em>.</p>
<h2 id="Test-it"><a href="#Test-it" class="headerlink" title="Test it!"></a>Test it!</h2><p>Now to try this out download our little test <a href="https://github.com/opencv/opencv/tree/3.4/samples/cpp/tutorial_code/introduction/windows_visual_studio_opencv/introduction_windows_vs.cpp">source code
</a><br>or get it from the sample code folder of the OpenCV sources. Add this to your project and build it.<br>Here’s its content:</p>
<p>@include cpp&#x2F;tutorial_code&#x2F;introduction&#x2F;windows_visual_studio_opencv&#x2F;introduction_windows_vs.cpp</p>
<p>You can start a Visual Studio build from two places. Either inside from the <em>IDE</em> (keyboard<br>combination: Control-F5) or by navigating to your build directory and start the application with a<br>double click. The catch is that these two <strong>aren’t</strong> the same. When you start it from the <em>IDE</em> its<br>current working directory is the projects directory, while otherwise it is the folder where the<br>application file currently is (so usually your build directory). Moreover, in case of starting from<br>the <em>IDE</em> the console window will not close once finished. It will wait for a keystroke of yours.</p>
<p>This is important to remember when you code inside the code open and save commands. Your resources<br>will be saved ( and queried for at opening!!!) relatively to your working directory. This is unless<br>you give a full, explicit path as a parameter for the I&#x2F;O functions. In the code above we open <a href="https://github.com/opencv/opencv/tree/3.4/samples/data/opencv-logo.png">this<br>OpenCV logo</a>. Before starting up the application,<br>make sure you place<br>the image file in your current working directory. Modify the image file name inside the code to try<br>it out on other images too. Run it and voil á:</p>
<p><img src="/images/SuccessVisualStudioWindows.jpg"></p>
<h2 id="Command-line-arguments-with-Visual-Studio"><a href="#Command-line-arguments-with-Visual-Studio" class="headerlink" title="Command line arguments with Visual Studio"></a>Command line arguments with Visual Studio</h2><p>Throughout some of our future tutorials, you’ll see that the programs main input method will be by<br>giving a runtime argument. To do this you can just start up a command windows (cmd + Enter in the<br>start menu), navigate to your executable file and start it with an argument. So for example in case<br>of my upper project this would look like:<br>@code{.bash}<br>D:<br>CD OpenCV\MySolutionName\Release<br>MySolutionName.exe exampleImage.jpg<br>@endcode<br>Here I first changed my drive (if your project isn’t on the OS local drive), navigated to my project<br>and start it with an example image argument. While under Linux system it is common to fiddle around<br>with the console window on the Microsoft Windows many people come to use it almost never. Besides,<br>adding the same argument again and again while you are testing your application is, somewhat, a<br>cumbersome task. Luckily, in the Visual Studio there is a menu to automate all this:</p>
<p><img src="/images/VisualStudioCommandLineArguments.jpg"></p>
<p>Specify here the name of the inputs and while you start your application from the Visual Studio<br>environment you have automatic argument passing. In the next introductory tutorial you’ll see an<br>in-depth explanation of the upper source code: @ref tutorial_display_image.</p>
