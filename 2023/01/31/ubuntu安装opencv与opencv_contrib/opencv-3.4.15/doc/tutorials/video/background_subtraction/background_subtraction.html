<h1 id="How-to-Use-Background-Subtraction-Methods-tutorial-background-subtraction"><a href="#How-to-Use-Background-Subtraction-Methods-tutorial-background-subtraction" class="headerlink" title="How to Use Background Subtraction Methods {#tutorial_background_subtraction}"></a>How to Use Background Subtraction Methods {#tutorial_background_subtraction}</h1><p>@next_tutorial{tutorial_meanshift}</p>
<ul>
<li><p>Background subtraction (BS) is a common and widely used technique for generating a foreground<br>mask (namely, a binary image containing the pixels belonging to moving objects in the scene) by<br>using static cameras.</p>
</li>
<li><p>As the name suggests, BS calculates the foreground mask performing a subtraction between the<br>current frame and a background model, containing the static part of the scene or, more in<br>general, everything that can be considered as background given the characteristics of the<br>observed scene.</p>
<p><img src="/images/Background_Subtraction_Tutorial_Scheme.png"></p>
</li>
<li><p>Background modeling consists of two main steps:</p>
<p>-#  Background Initialization;<br>-#  Background Update.</p>
<p>In the first step, an initial model of the background is computed, while in the second step that<br>model is updated in order to adapt to possible changes in the scene.</p>
</li>
<li><p>In this tutorial we will learn how to perform BS by using OpenCV.</p>
</li>
</ul>
<h2 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h2><p>In this tutorial you will learn how to:</p>
<p>-#  Read data from videos or image sequences by using @ref cv::VideoCapture ;<br>-#  Create and update the background model by using @ref cv::BackgroundSubtractor class;<br>-#  Get and show the foreground mask by using @ref cv::imshow ;</p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>In the following you can find the source code. We will let the user choose to process either a video<br>file or a sequence of images.</p>
<p>We will use @ref cv::BackgroundSubtractorMOG2 in this sample, to generate the foreground mask.</p>
<p>The results as well as the input data are shown on the screen.</p>
<p>@add_toggle_cpp</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/cpp/tutorial_code/video/bg_sub.cpp">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;cpp&#x2F;tutorial_code&#x2F;video&#x2F;bg_sub.cpp<br>@end_toggle</p>
</li>
</ul>
<p>@add_toggle_java</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/java/tutorial_code/video/background_subtraction/BackgroundSubtractionDemo.java">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;java&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;BackgroundSubtractionDemo.java<br>@end_toggle</p>
</li>
</ul>
<p>@add_toggle_python</p>
<ul>
<li><p><strong>Downloadable code</strong>: Click<br><a href="https://github.com/opencv/opencv/tree/3.4/samples/python/tutorial_code/video/background_subtraction/bg_sub.py">here</a></p>
</li>
<li><p><strong>Code at glance:</strong><br>@include samples&#x2F;python&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;bg_sub.py<br>@end_toggle</p>
</li>
</ul>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>We discuss the main parts of the code above:</p>
<ul>
<li>A @ref cv::BackgroundSubtractor object will be used to generate the foreground mask. In this<br>example, default parameters are used, but it is also possible to declare specific parameters in<br>the create function.</li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;video&#x2F;bg_sub.cpp create<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;BackgroundSubtractionDemo.java create<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;bg_sub.py create<br>@end_toggle</p>
<ul>
<li>A @ref cv::VideoCapture object is used to read the input video or input images sequence.</li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;video&#x2F;bg_sub.cpp capture<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;BackgroundSubtractionDemo.java capture<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;bg_sub.py capture<br>@end_toggle</p>
<ul>
<li>Every frame is used both for calculating the foreground mask and for updating the background. If<br>you want to change the learning rate used for updating the background model, it is possible to<br>set a specific learning rate by passing a parameter to the <code>apply</code> method.</li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;video&#x2F;bg_sub.cpp apply<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;BackgroundSubtractionDemo.java apply<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;bg_sub.py apply<br>@end_toggle</p>
<ul>
<li>The current frame number can be extracted from the @ref cv::VideoCapture object and stamped in<br>the top left corner of the current frame. A white rectangle is used to highlight the black<br>colored frame number.</li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;video&#x2F;bg_sub.cpp display_frame_number<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;BackgroundSubtractionDemo.java display_frame_number<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;bg_sub.py display_frame_number<br>@end_toggle</p>
<ul>
<li>We are ready to show the current input frame and the results.</li>
</ul>
<p>@add_toggle_cpp<br>@snippet samples&#x2F;cpp&#x2F;tutorial_code&#x2F;video&#x2F;bg_sub.cpp show<br>@end_toggle</p>
<p>@add_toggle_java<br>@snippet samples&#x2F;java&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;BackgroundSubtractionDemo.java show<br>@end_toggle</p>
<p>@add_toggle_python<br>@snippet samples&#x2F;python&#x2F;tutorial_code&#x2F;video&#x2F;background_subtraction&#x2F;bg_sub.py show<br>@end_toggle</p>
<h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><ul>
<li><p>With the <code>vtest.avi</code> video, for the following frame:</p>
<p><img src="/images/Background_Subtraction_Tutorial_frame.jpg"></p>
<p>The output of the program will look as the following for MOG2 method (gray areas are detected shadows):</p>
<p><img src="/images/Background_Subtraction_Tutorial_result_MOG2.jpg"></p>
<p>The output of the program will look as the following for the KNN method (gray areas are detected shadows):</p>
<p><img src="/images/Background_Subtraction_Tutorial_result_KNN.jpg"></p>
</li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://web.archive.org/web/20140418093037/http://bmc.univ-bpclermont.fr/">Background Models Challenge (BMC) website</a></li>
<li>A Benchmark Dataset for Foreground&#x2F;Background Extraction @cite vacavant2013benchmark</li>
</ul>
