<h1 id="Calibration-with-ArUco-and-ChArUco-tutorial-aruco-calibration"><a href="#Calibration-with-ArUco-and-ChArUco-tutorial-aruco-calibration" class="headerlink" title="Calibration with ArUco and ChArUco {#tutorial_aruco_calibration}"></a>Calibration with ArUco and ChArUco {#tutorial_aruco_calibration}</h1><p>The ArUco module can also be used to calibrate a camera. Camera calibration consists in obtaining the<br>camera intrinsic parameters and distortion coefficients. This parameters remain fixed unless the camera<br>optic is modified, thus camera calibration only need to be done once.</p>
<p>Camera calibration is usually performed using the OpenCV <code>calibrateCamera()</code> function. This function<br>requires some correspondences between environment points and their projection in the camera image from<br>different viewpoints. In general, these correspondences are obtained from the corners of chessboard<br>patterns. See <code>calibrateCamera()</code> function documentation or the OpenCV calibration tutorial for<br>more detailed information.</p>
<p>Using the ArUco module, calibration can be performed based on ArUco markers corners or ChArUco corners.<br>Calibrating using ArUco is much more versatile than using traditional chessboard patterns, since it<br>allows occlusions or partial views.</p>
<p>As it can be stated, calibration can be done using both, marker corners or ChArUco corners. However,<br>it is highly recommended using the ChArUco corners approach since the provided corners are much<br>more accurate in comparison to the marker corners. Calibration using a standard Board should only be<br>employed in those scenarios where the ChArUco boards cannot be employed because of any kind of restriction.</p>
<h2 id="Calibration-with-ChArUco-Boards"><a href="#Calibration-with-ChArUco-Boards" class="headerlink" title="Calibration with ChArUco Boards"></a>Calibration with ChArUco Boards</h2><p>To calibrate using a ChArUco board, it is necessary to detect the board from different viewpoints, in the<br>same way that the standard calibration does with the traditional chessboard pattern. However, due to the<br>benefits of using ChArUco, occlusions and partial views are allowed, and not all the corners need to be<br>visible in all the viewpoints.</p>
<p><img src="/images/charucocalibration.png" alt="ChArUco calibration viewpoints"></p>
<p>The function to calibrate is <code>calibrateCameraCharuco()</code>. Example:</p>
<p>@code{.cpp}<br>    cv::Ptr<a href="aruco::CharucoBoard">aruco::CharucoBoard</a> board &#x3D; … &#x2F;&#x2F; create charuco board<br>    cv::Size imgSize &#x3D; … &#x2F;&#x2F; camera image size</p>
<pre><code>std::vector&lt;std::vector&lt;cv::Point2f&gt;&gt; allCharucoCorners;
std::vector&lt;std::vector&lt;int&gt;&gt; allCharucoIds;
// Detect charuco board from several viewpoints and fill allCharucoCorners and allCharucoIds
...
...

// After capturing in several viewpoints, start calibration
cv::Mat cameraMatrix, distCoeffs;
std::vector&lt;cv::Mat&gt; rvecs, tvecs;
int calibrationFlags = ... // Set calibration flags (same than in calibrateCamera() function)

double repError = cv::aruco::calibrateCameraCharuco(allCharucoCorners, allCharucoIds, board, imgSize, cameraMatrix, distCoeffs, rvecs, tvecs, calibrationFlags);
</code></pre>
<p>@endcode</p>
<p>The ChArUco corners and ChArUco identifiers captured on each viewpoint are stored in the vectors <code>allCharucoCorners</code> and <code>allCharucoIds</code>, one element per viewpoint.</p>
<p>The <code>calibrateCameraCharuco()</code> function will fill the <code>cameraMatrix</code> and <code>distCoeffs</code> arrays with the camera calibration parameters. It will return the reprojection<br>error obtained from the calibration. The elements in <code>rvecs</code> and <code>tvecs</code> will be filled with the estimated pose of the camera (respect to the ChArUco board)<br>in each of the viewpoints.</p>
<p>Finally, the <code>calibrationFlags</code> parameter determines some of the options for the calibration. Its format is equivalent to the flags parameter in the OpenCV<br><code>calibrateCamera()</code> function.</p>
<p>A full working example is included in the <code>calibrate_camera_charuco.cpp</code> inside the module samples folder.</p>
<p>Note: The samples now take input via commandline via the <a href="http://docs.opencv.org/trunk/d0/d2e/classcv_1_1CommandLineParser.html#gsc.tab=0">OpenCV Commandline Parser</a>. For this file the example parameters will look like<br>@code{.cpp}<br>    <em>output path</em>“ -dp&#x3D;”<em>path</em>&#x2F;detector_params.yml” -w&#x3D;5 -h&#x3D;7 -sl&#x3D;0.04 -ml&#x3D;0.02 -d&#x3D;10<br>@endcode</p>
<h2 id="Calibration-with-ArUco-Boards"><a href="#Calibration-with-ArUco-Boards" class="headerlink" title="Calibration with ArUco Boards"></a>Calibration with ArUco Boards</h2><p>As it has been stated, it is recommended the use of ChAruco boards instead of ArUco boards for camera calibration, since<br>ChArUco corners are more accurate than marker corners. However, in some special cases it must be required to use calibration<br>based on ArUco boards. For these cases, the <code>calibrateCameraAruco()</code> function is provided. As in the previous case, it<br>requires the detections of an ArUco board from different viewpoints.</p>
<p><img src="/images/arucocalibration.png" alt="ArUco calibration viewpoints"></p>
<p>Example of <code>calibrateCameraAruco()</code> use:</p>
<p>@code{.cpp}<br>    cv::Ptr<a href="aruco::Board">aruco::Board</a> board &#x3D; … &#x2F;&#x2F; create aruco board<br>    cv::Size imgSize &#x3D; … &#x2F;&#x2F; camera image size</p>
<pre><code>std::vector&lt;std::vector&lt;cv::Point2f&gt;&gt; allCornersConcatenated;
std::vector&lt;int&gt; allIdsConcatenated;
std::vector&lt;int&gt; markerCounterPerFrame;
// Detect aruco board from several viewpoints and fill allCornersConcatenated, allIdsConcatenated and markerCounterPerFrame
...
...

// After capturing in several viewpoints, start calibration
cv::Mat cameraMatrix, distCoeffs;
std::vector&lt;cv::Mat&gt; rvecs, tvecs;
int calibrationFlags = ... // Set calibration flags (same than in calibrateCamera() function)

double repError = cv::aruco::calibrateCameraAruco(allCornersConcatenated, allIdsConcatenated, markerCounterPerFrame, board, imgSize, cameraMatrix, distCoeffs, rvecs, tvecs, calibrationFlags);
</code></pre>
<p>@endcode</p>
<p>In this case, and contrary to the <code>calibrateCameraCharuco()</code> function, the detected markers on each viewpoint are concatenated in the arrays <code>allCornersConcatenated</code> and<br><code>allCornersConcatenated</code> (the first two parameters). The third parameter, the array <code>markerCounterPerFrame</code>, indicates the number of marker detected on each viewpoint.<br>The rest of parameters are the same than in <code>calibrateCameraCharuco()</code>, except the board layout object which does not need to be a <code>CharucoBoard</code> object, it can be<br>any <code>Board</code> object.</p>
<p>A full working example is included in the <code>calibrate_camera.cpp</code> inside the module samples folder.</p>
<p>Note: The samples now take input via commandline via the <a href="http://docs.opencv.org/trunk/d0/d2e/classcv_1_1CommandLineParser.html#gsc.tab=0">OpenCV Commandline Parser</a>. For this file the example parameters will look like<br>@code{.cpp}<br>    “<em>path</em>&#x2F;calib.txt” -w&#x3D;5 -h&#x3D;7 -l&#x3D;100 -s&#x3D;10 -d&#x3D;10<br>@endcode</p>
