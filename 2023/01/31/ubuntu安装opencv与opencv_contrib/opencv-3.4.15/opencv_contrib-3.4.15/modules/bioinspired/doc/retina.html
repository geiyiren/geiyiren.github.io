<h1 id="Bioinspired-Module-Retina-Introduction-bioinspired-retina"><a href="#Bioinspired-Module-Retina-Introduction-bioinspired-retina" class="headerlink" title="Bioinspired Module Retina Introduction {#bioinspired_retina}"></a>Bioinspired Module Retina Introduction {#bioinspired_retina}</h1><h2 id="Retina-class-overview"><a href="#Retina-class-overview" class="headerlink" title="Retina class overview"></a>Retina class overview</h2><p>@note do not forget that the retina model is included in the following namespace : cv::bioinspired with C++ and in cv.bioinspired with Python</p>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>This class provides the main controls of the Gipsa&#x2F;Listic labs human retina model. This is a non<br>separable spatio-temporal filter modelling the two main retina information channels :</p>
<ul>
<li>foveal vision for detailed color vision : the parvocellular pathway.</li>
<li>peripheral vision for sensitive transient signals detection (motion and events) : the magnocellular pathway.</li>
</ul>
<p>This model originates from Jeanny Herault work @cite Herault2010 . It has been<br>involved in Alexandre Benoit phd and his current research @cite Benoit2010, @cite Benoit2014 . He<br>currently maintains this module within OpenCV. It includes the work of other Jeanny’s phd student<br>such as @cite Chaix2007 and the log polar transformations of Barthelemy Durette described in Jeanny’s<br>book.</p>
<p>More into details here is an overview of the retina properties that are implemented here :</p>
<ul>
<li>regarding luminance and details enhancement :<ul>
<li>local logarithmic luminance compression (at the entry point by photoreceptors and at the output by ganglion cells).</li>
<li>spectral whitening at the Outer Plexiform Layer level (photoreceptors and horizontal cells spatio-temporal filtering).</li>
</ul>
</li>
</ul>
<p>The former behavior compresses luminance range and allows very bright areas and very dark ones to be visible on the same picture with lots of details. The latter reduces low frequency luminance energy (mean luminance) and enhances mid-frequencies (details). Applied all together, retina well prepares visual signals prior high level analysis. Those properties are really interesting with videos where light changes are dramatically reduced with an interesting temporal consistency.</p>
<ul>
<li>regarding noise filtering :<ul>
<li>high frequency spatial and temporal noise is filtered out. Both outputs Parvo and Magno pathways benefit from this. Noise reduction benefits from the non separable spatio-temporal filtering.</li>
<li>at the Parvo output, static textures are enhanced and noise is filtered (on videos, temporal noise is nicely removed). However, as human behaviors, moving textures are smoothed. Then, moving object details can be only enhanced  if the retina tracks it and keeps it static from its point of view.</li>
<li>at Magno output, it allows a cleaner detection of events (motion, changes) with reduced noise errors even in difficult lighting conditions. As a compromise, the Magno output is a low spatial frequency signal and allows events’ blobs to be reliably extracted (check the TransientAreasSegmentationModule module for that).</li>
</ul>
</li>
</ul>
<h3 id="Use"><a href="#Use" class="headerlink" title="Use"></a>Use</h3><p>This model can be used as a preprocessing stage in the aim of :</p>
<ul>
<li>performing texture analysis with enhanced signal to noise ratio and enhanced details which are robust<br>against input images luminance ranges (check out the parvocellular retina channel output, by<br>using the provided <strong>getParvo</strong> methods)</li>
<li>performing motion analysis that is also taking advantage of the previously cited properties (check out the<br>magnocellular retina channel output, by using the provided <strong>getMagno</strong> methods)</li>
<li>general image&#x2F;video sequence description using either one or both channels. An example of the<br>use of Retina in a Bag of Words approach is given in @cite Benoit2014 .</li>
</ul>
<p>@note</p>
<ul>
<li>For ease of use in computer vision applications, the two retina channels are applied<br>on all the input images. This does not follow the real retina topology but it is practical from an image processing point of view. If retina mapping (foveal and parafoveal vision) is required, use the log sampling capabilities proposed within the class.</li>
<li>Please do not hesitate to contribute by extending the retina description, code, use cases for complementary explanations and demonstrations.</li>
</ul>
<h3 id="Use-case-illustrations"><a href="#Use-case-illustrations" class="headerlink" title="Use case illustrations"></a>Use case illustrations</h3><h4 id="Image-preprocessing-using-the-Parvocellular-pathway-parvo-retina-output"><a href="#Image-preprocessing-using-the-Parvocellular-pathway-parvo-retina-output" class="headerlink" title="Image preprocessing using the Parvocellular pathway (parvo retina output)"></a>Image preprocessing using the Parvocellular pathway (parvo retina output)</h4><p>As a preliminary presentation, let’s start with a visual example. We propose to apply the filter on<br>a low quality color jpeg image with backlight problems. Here is the considered input… <em>“Well,i could see more with my eyes than what i captured with my camera…”</em></p>
<p><img src="/images/retinaInput.jpg" alt="a low quality color jpeg image with backlight problems."></p>
<p>Below, the retina foveal model applied on the entire image with default parameters. Details are enforced whatever the local luminance is. Here there contours<br>are strongly enforced but the noise level is kept low. Halo effects are voluntary visible with this configuration. See parameters discussion<br>below and increase horizontalCellsGain near 1 to remove them.</p>
<p><img src="/images/retinaOutput_default.jpg" alt="the retina foveal model applied on the entire image with default parameters. Here contours are enforced, luminance is corrected and halo effects are voluntary visible with this configuration, increase horizontalCellsGain near 1 to remove them."></p>
<p>Below, a second retina foveal model output applied on the entire image with a parameters setup<br>focused on naturalness perception. <em>“Hey, i now recognize my cat, looking at the mountains at the<br>end of the day !”</em>. Here contours are enforced, luminance is corrected but halos are avoided with<br>this configuration. The backlight effect is corrected and highlight details are still preserved.<br>Then, even on a low quality jpeg image, if some luminance’s information remains, the retina is able to<br>reconstruct a proper visual signal. Such configuration is also useful for High Dynamic Range<br>(<em>HDR</em>) images compression to 8bit images as discussed in @cite Benoit2010 and in the demonstration<br>codes discussed below. As shown at the end of the page, parameter changes from defaults are :</p>
<ul>
<li>horizontalCellsGain&#x3D;0.3</li>
<li>photoreceptorsLocalAdaptationSensitivity&#x3D;ganglioncellsSensitivity&#x3D;0.89.</li>
</ul>
<p><img src="/images/retinaOutput_realistic.jpg" alt="the retina foveal model applied on the entire image with &#39;naturalness&#39; parameters. Here contours are enforced but halo effects are avoided with this configuration, horizontalCellsGain is 0.3 and photoreceptorsLocalAdaptationSensitivity=ganglioncellsSensitivity=0.89."></p>
<p>As observed in this preliminary demo, the retina can be settled up with various parameters, by<br>default, as shown on the figure above, the retina strongly reduces mean luminance energy and<br>enforces all details of the visual scene. Luminance energy and halo effects can be modulated<br>(exaggerated to cancelled as shown on the two examples). In order to use your own parameters, you can<br>use at least one time the <em>write(String fs)</em> method which will write a proper XML file with all<br>default parameters. Then, tweak it on your own and reload them at any time using method<br><em>setup(String fs)</em>. These methods update a <em>Retina::RetinaParameters</em> member structure that is<br>described hereafter. XML parameters file samples are shown at the end of the page.</p>
<h4 id="Tone-mapping-processing-capability-using-the-Parvocellular-pathway-parvo-retina-output"><a href="#Tone-mapping-processing-capability-using-the-Parvocellular-pathway-parvo-retina-output" class="headerlink" title="Tone mapping processing capability using the Parvocellular pathway (parvo retina output)"></a>Tone mapping processing capability using the Parvocellular pathway (parvo retina output)</h4><p>This retina model naturally handles luminance range compression. Local adaptation stages and spectral whitening contribute<br>to luminance range compression. In addition, high frequency noise that often corrupts tone mapped images is removed at early stages of the<br>process thus leading to natural perception and noise free tone mapping.</p>
<p>Compared to the demos shown above, setup differences are the following ones: (see bioinspired&#x2F;samples&#x2F;OpenEXRimages_HDR_Retina_toneMapping.cpp for more details)</p>
<ul>
<li>load HDR images (OpenEXR format is supported by OpenCV) and cut histogram borders at ~5% and 95% to eliminate salt&amp;pepper like pixel’s corruption.</li>
<li>apply retina with default parameters along with the following changes (generic parameters used for the presented illustrations of the section) : <ul>
<li>retina Hcells gain &#x3D;0.4 (the main change compared to the default configuration : it strongly reduces halo effects)</li>
<li>localAdaptation_photoreceptors&#x3D;0.99 (a little higher than default value to enforce local adaptation)</li>
<li>localAdaptation_Gcells&#x3D;0.95 (also slightly higher than default for local adaptation enforcement)</li>
</ul>
</li>
<li>get the parvo output using the <em>getParvo()</em> method.</li>
</ul>
<p>Have a look at the end of this page to see how to specify these parameters in a configuration file.</p>
<p>The following two illustrations show the effect of such configuration on 2 image samples.</p>
<p><img src="/images/HDRtoneMapping_candleSample.jpg" alt="HDR image tone mapping example with generic parameters. Original image comes from http://openexr.com/ samples (openexr-images-1.7.0/ScanLines/CandleGlass.exr)"></p>
<p><img src="/images/HDRtoneMapping_memorialSample.jpg" alt="HDR image tone mapping example with the same generic parameters. Original image comes from http://www.pauldebevec.com/Research/HDR/memorial.exr)"></p>
<h4 id="Motion-and-event-detection-using-the-Magnocellular-pathway-magno-retina-output"><a href="#Motion-and-event-detection-using-the-Magnocellular-pathway-magno-retina-output" class="headerlink" title="Motion and event detection using the Magnocellular pathway (magno retina output)"></a>Motion and event detection using the Magnocellular pathway (magno retina output)</h4><p>Spatio-temporal events can be easily detected using <em>magno</em> output of the retina (use the <em>getMagno()</em> method). Its energy linearly increases with motion speed.<br>An event blob detector is proposed with the TransientAreasSegmentationModule class also provided in the bioinspired module. The basic idea is to detect local energy drops with regard of the neighborhood and then to apply a threshold. Such process has been used in a bag of words description of videos on the TRECVid challenge @cite Benoit2014 and only allows video frames description on transient areas.</p>
<p>We present here some illustrations of the retina outputs on some examples taken from <a href="http://changedetection.net/">http://changedetection.net/</a> with RGB and thermal videos.</p>
<p>@note here, we use the default retina setup that generates halos around strong edges. Note that temporal constants allow a temporal effect to be visible on moting objects (useful for still image illustrations of a video). Halos can be removed by increasing retina Hcells gain while temporal effects can be reduced by decreasing temporal constant values.<br>Also take into account that the two retina outputs are rescaled in range [0:255] such that magno output can show a lot of “noise” when nothing moves while drawing it. However, its energy remains low if you retrieve it using <em>getMagnoRAW</em> getter instead.</p>
<p><img src="/images/VideoDemo_RGB_PETS2006.jpg" alt="Retina processing on RGB image sequence : example from http://changedetection.net/ (baseline/PETS2006). Parvo enforces static signals but smooths moving persons since they do not remain static from its point of view. Magno channel highligths moving persons, observe the energy mapping on the one on top, partly behind a dark glass."></p>
<p><img src="/images/VideoDemo_thermal_park.jpg" alt="Retina processing on gray levels image sequence : example from http://changedetection.net/ (thermal/park). On such grayscale images, parvo channel enforces contrasts while magno strongly reacts on moving pedestrians"></p>
<h3 id="Literature"><a href="#Literature" class="headerlink" title="Literature"></a>Literature</h3><p>For more information, refer to the following papers :</p>
<ul>
<li><p>Model description : @cite Benoit2010</p>
</li>
<li><p>Model use in a Bag of Words approach : @cite Benoit2014</p>
</li>
<li><p>Please have a look at the reference work of Jeanny Herault that you can read in his book : @cite Herault2010</p>
</li>
</ul>
<p>This retina filter code includes the research contributions of phd&#x2F;research colleagues from which<br>code has been redrawn by the author :</p>
<ul>
<li><p>take a look at the <em>retinacolor.hpp</em> module to discover Brice Chaix de Lavarene phD color<br>mosaicing&#x2F;demosaicing and his reference paper: @cite Chaix2007</p>
</li>
<li><p>take a look at <em>imagelogpolprojection.hpp</em> to discover retina spatial log sampling which<br>originates from Barthelemy Durette phd with Jeanny Herault. A Retina &#x2F; V1 cortex projection is<br>also proposed and originates from Jeanny’s discussions. More informations in the above cited<br>Jeanny Heraults’s book.</p>
</li>
<li><p>Meylan&amp;al work on HDR tone mapping that is implemented as a specific method within the model : @cite Meylan2007</p>
</li>
</ul>
<h2 id="Retina-programming-interfaces"><a href="#Retina-programming-interfaces" class="headerlink" title="Retina programming interfaces"></a>Retina programming interfaces</h2><p>The proposed class allows the <a href="http://www.gipsa-lab.inpg.fr/">Gipsa</a> (preliminary work) &#x2F;<br><a href="http://www.listic.univ-savoie.fr/">Listic</a> labs retina model to be used.<br>It can be applied on still images, images sequences and video sequences.</p>
<p>Here is an overview of the Retina interface, allocate one instance with the <em>Retina::create()</em><br>functions (C++, Java, Python) :</p>
<p>@code{.cpp}<br>    namespace cv{namespace bioinspired{</p>
<pre><code>class Retina : public Algorithm
{
public:
  // parameters setup instance
  struct RetinaParameters; // this class is detailed later

  // main method for input frame processing (all use method, can also perform High Dynamic Range tone mapping)
  void run (InputArray inputImage);

  // specific method aiming at correcting luminance only (faster High Dynamic Range tone mapping)
  void applyFastToneMapping(InputArray inputImage, OutputArray outputToneMappedImage)

  // output buffers retrieval methods
  // -&gt; foveal color vision details channel with luminance and noise correction
  void getParvo (OutputArray retinaOutput_parvo);
  void getParvoRAW (OutputArray retinaOutput_parvo);// retrieve original output buffers without any normalisation
  const Mat getParvoRAW () const;// retrieve original output buffers without any normalisation
  // -&gt; peripheral monochrome motion and events (transient information) channel
  void getMagno (OutputArray retinaOutput_magno);
  void getMagnoRAW (OutputArray retinaOutput_magno); // retrieve original output buffers without any normalisation
  const Mat getMagnoRAW () const;// retrieve original output buffers without any normalisation

  // reset retina buffers... equivalent to closing your eyes for some seconds
  void clearBuffers ();

  // retrieve input and output buffers sizes
  Size getInputSize ();
  Size getOutputSize ();

  // setup methods with specific parameters specification of global xml config file loading/write
  void setup (String retinaParameterFile=&quot;&quot;, const bool applyDefaultSetupOnFailure=true);
  void setup (FileStorage &amp;fs, const bool applyDefaultSetupOnFailure=true);
  void setup (RetinaParameters newParameters);
  struct Retina::RetinaParameters getParameters ();
  const String printSetup ();
  virtual void write (String fs) const;
  virtual void write (FileStorage &amp;fs) const;
  void setupOPLandIPLParvoChannel (const bool colorMode=true, const bool normaliseOutput=true, const float photoreceptorsLocalAdaptationSensitivity=0.7, const float photoreceptorsTemporalConstant=0.5, const float photoreceptorsSpatialConstant=0.53, const float horizontalCellsGain=0, const float HcellsTemporalConstant=1, const float HcellsSpatialConstant=7, const float ganglionCellsSensitivity=0.7);
  void setupIPLMagnoChannel (const bool normaliseOutput=true, const float parasolCells_beta=0, const float parasolCells_tau=0, const float parasolCells_k=7, const float amacrinCellsTemporalCutFrequency=1.2, const float V0CompressionParameter=0.95, const float localAdaptintegration_tau=0, const float localAdaptintegration_k=7);
  void setColorSaturation (const bool saturateColors=true, const float colorSaturationValue=4.0);
  void activateMovingContoursProcessing (const bool activate);
  void activateContoursProcessing (const bool activate);
};

  // Allocators
  cv::Ptr&lt;Retina&gt; Retina::create (Size inputSize);
  cv::Ptr&lt;Retina&gt; Retina::create (Size inputSize, const bool colorMode, RETINA_COLORSAMPLINGMETHOD colorSamplingMethod=RETINA_COLOR_BAYER, const bool useRetinaLogSampling=false, const double reductionFactor=1.0, const double samplingStrength=10.0);
  }} // cv and bioinspired namespaces end
</code></pre>
<p>@endcode</p>
<h3 id="Setting-up-Retina"><a href="#Setting-up-Retina" class="headerlink" title="Setting up Retina"></a>Setting up Retina</h3><h4 id="Managing-the-configuration-file"><a href="#Managing-the-configuration-file" class="headerlink" title="Managing the configuration file"></a>Managing the configuration file</h4><p>When using the <em>Retina::write</em> and <em>Retina::load</em> methods, you create or load a XML file that stores Retina configuration.</p>
<p>The default configuration is presented below.</p>
<p>@code{.xml}<br><?xml version="1.0"?><br><opencv_storage><br><OPLandIPLparvo><br>    <colorMode>1</colorMode><br>    <normaliseOutput>1</normaliseOutput><br>    <photoreceptorsLocalAdaptationSensitivity>7.5e-01</photoreceptorsLocalAdaptationSensitivity><br>    <photoreceptorsTemporalConstant>9.0e-01</photoreceptorsTemporalConstant><br>    <photoreceptorsSpatialConstant>5.7e-01</photoreceptorsSpatialConstant><br>    <horizontalCellsGain>0.01</horizontalCellsGain><br>    <hcellsTemporalConstant>0.5</hcellsTemporalConstant><br>    <hcellsSpatialConstant>7.</hcellsSpatialConstant><br>    <ganglionCellsSensitivity>7.5e-01</ganglionCellsSensitivity></OPLandIPLparvo><br><IPLmagno><br>    <normaliseOutput>1</normaliseOutput><br>    <parasolCells_beta>0.</parasolCells_beta><br>    <parasolCells_tau>0.</parasolCells_tau><br>    <parasolCells_k>7.</parasolCells_k><br>    <amacrinCellsTemporalCutFrequency>2.0e+00</amacrinCellsTemporalCutFrequency><br>    <V0CompressionParameter>9.5e-01</V0CompressionParameter><br>    <localAdaptintegration_tau>0.</localAdaptintegration_tau><br>    <localAdaptintegration_k>7.</localAdaptintegration_k></IPLmagno><br></opencv_storage><br>@endcode</p>
<p>Here are some words about all those parameters, tweak them as you wish to amplify or moderate retina effects (contours enforcement, halos effects, motion sensitivity, motion blurring, etc.)</p>
<h4 id="Basic-parameters"><a href="#Basic-parameters" class="headerlink" title="Basic parameters"></a>Basic parameters</h4><p>The simplest parameters are as follows :</p>
<ul>
<li><strong>colorMode</strong> : let the retina process color information (if 1) or gray scale images (if 0). In<br>that last case, only the first channels of the input will be processed.</li>
<li><strong>normaliseOutput</strong> : each channel has such parameter: if the value is set to 1, then the considered<br>channel’s output is rescaled between 0 and 255. Be aware at this case of the Magnocellular output<br>level (motion&#x2F;transient channel detection). Residual noise will also be rescaled !</li>
</ul>
<p><strong>Note :</strong> using color requires color channels multiplexing&#x2F;demultipexing which also demands more<br>processing. You can expect much faster processing using gray levels : it would require around 30<br>product per pixel for all of the retina processes and it has recently been parallelized for multicore<br>architectures.</p>
<h4 id="Photo-receptors-parameters"><a href="#Photo-receptors-parameters" class="headerlink" title="Photo-receptors parameters"></a>Photo-receptors parameters</h4><p>The following parameters act on the entry point of the retina - photo-receptors - and has impact on all<br> of the following processes. These sensors are low pass spatio-temporal filters that smooth temporal and<br>spatial data and also adjust their sensitivity to local luminance,thus, leads to improving details extraction<br>and high frequency noise canceling.</p>
<ul>
<li><strong>photoreceptorsLocalAdaptationSensitivity</strong> between 0 and 1. Values close to 1 allow high<br>luminance log compression’s effect at the photo-receptors level. Values closer to 0 provide a more<br>linear sensitivity. Increased alone, it can burn the <em>Parvo (details channel)</em> output image. If<br>adjusted in collaboration with <strong>ganglionCellsSensitivity</strong>,images can be very contrasted<br>whatever the local luminance there is… at the cost of a naturalness decrease.</li>
<li><strong>photoreceptorsTemporalConstant</strong> this setups the temporal constant of the low pass filter<br>effect at the entry of the retina. High value leads to strong temporal smoothing effect : moving<br>objects are blurred and can disappear while static object are favored. But when starting the<br>retina processing, stable state is reached later.</li>
<li><strong>photoreceptorsSpatialConstant</strong> specifies the spatial constant related to photo-receptors’ low<br>pass filter’s effect. Those parameters specify the minimum value of the spatial signal period allowed<br>in what follows. Typically, this filter should cut high frequency noise. On the other hand, a 0 value<br>cuts none of the noise while higher values start to cut high spatial frequencies, and progressively<br>lower frequencies… Be aware to not go to high levels if you want to see some details of the input images !<br>A good compromise for color images is a 0.53 value since such choice won’t affect too much the color spectrum.<br>Higher values would lead to gray and blurred output images.</li>
</ul>
<h4 id="Horizontal-cells-parameters"><a href="#Horizontal-cells-parameters" class="headerlink" title="Horizontal cells parameters"></a>Horizontal cells parameters</h4><p>This parameter set tunes the neural network connected to the photo-receptors, the horizontal cells.<br>It modulates photo-receptors sensitivity and completes the processing for final spectral whitening<br>(part of the spatial band pass effect thus favoring visual details enhancement).</p>
<ul>
<li><strong>horizontalCellsGain</strong> here is a critical parameter ! If you are not interested with the mean<br>luminance and want just to focus on details enhancement, then, set this parameterto zero. However, if<br>you want to keep some environment luminance’s data, let some low spatial frequencies pass into the system and set a<br>higher value (&lt;1).</li>
<li><strong>hcellsTemporalConstant</strong> similar to photo-receptors, this parameter acts on the temporal constant of a<br>low pass temporal filter that smoothes input data. Here, a high value generates a high retina<br>after effect while a lower value makes the retina more reactive. This value should be lower than<br><strong>photoreceptorsTemporalConstant</strong> to limit strong retina after effects.</li>
<li><strong>hcellsSpatialConstant</strong> is the spatial constant of these cells filter’s low pass one.<br>It specifies the lowest spatial frequency allowed in what follows. Visually, a high value leads<br>to very low spatial frequencies processing and leads to salient halo effects. Lower values<br>reduce this effect but has the limit of not go lower than the value of<br><strong>photoreceptorsSpatialConstant</strong>. Those 2 parameters actually specify the spatial band-pass of<br>the retina.</li>
</ul>
<p><strong>NOTE</strong> Once the processing managed by the previous parameters is done, input data is cleaned from noise<br>and luminance is already partly enhanced. The following parameters act on the last processing stages<br>of the two outing retina signals.</p>
<h4 id="Parvo-details-channel-dedicated-parameter"><a href="#Parvo-details-channel-dedicated-parameter" class="headerlink" title="Parvo (details channel) dedicated parameter"></a>Parvo (details channel) dedicated parameter</h4><ul>
<li><strong>ganglionCellsSensitivity</strong> specifies the strength of the final local adaptation occurring at<br>the output of this details’ dedicated channel. Parameter values remain between 0 and 1. Low value<br>tend to give a linear response while higher values enforce the remaining low contrasted areas.</li>
</ul>
<p><strong>Note :</strong> this parameter can correct eventual burned images by favoring low energetic details of<br>the visual scene, even in bright areas.</p>
<h4 id="IPL-Magno-motion-x2F-transient-channel-parameters"><a href="#IPL-Magno-motion-x2F-transient-channel-parameters" class="headerlink" title="IPL Magno (motion&#x2F;transient channel) parameters"></a>IPL Magno (motion&#x2F;transient channel) parameters</h4><p>Once image’s information are cleaned, this channel acts as a high pass temporal filter that<br>selects only the signals related to transient signals (events, motion, etc.). A low pass spatial filter<br>smoothes extracted transient data while a final logarithmic compression enhances low transient events<br>thus enhancing event sensitivity.</p>
<ul>
<li><strong>parasolCells_beta</strong> generally set to zero, can be considered as an amplifier gain at the<br>entry point of this processing stage. Generally set to 0.</li>
<li><strong>parasolCells_tau</strong> the temporal smoothing effect that can be added</li>
<li><strong>parasolCells_k</strong> the spatial constant of the spatial filtering effect, set it at a high value<br>to favor low spatial frequency signals that are lower subject for residual noise.</li>
<li><strong>amacrinCellsTemporalCutFrequency</strong> specifies the temporal constant of the high pass filter.<br>High values let slow transient events to be selected.</li>
<li><strong>V0CompressionParameter</strong> specifies the strength of the log compression. Similar behaviors to<br>previous description but here  enforces sensitivity of transient events.</li>
<li><strong>localAdaptintegration_tau</strong> generally set to 0, has no real use actually in here. </li>
<li><strong>localAdaptintegration_k</strong> specifies the size of the area on which local adaptation is<br>performed. Low values lead to short range local adaptation (higher sensitivity to noise), high<br>values secure log compression.</li>
</ul>
<h3 id="Demos-and-experiments"><a href="#Demos-and-experiments" class="headerlink" title="Demos and experiments !"></a>Demos and experiments !</h3><h4 id="First-time-experiments"><a href="#First-time-experiments" class="headerlink" title="First time experiments"></a>First time experiments</h4><p>Here are some code snippets to shortly show how to use Retina with default parameters (with halo effects). Next section redirects to more complete demos provided with the main retina class.</p>
<p>Here is presented how to process a webcam stream with the following steps : </p>
<ul>
<li>load a frist input image to get its size</li>
<li>allocate a retina instance with appropriate input size</li>
<li>loop over grabbed frames :<ul>
<li>grab a new frame</li>
<li>run on a frame</li>
<li>call the two output getters</li>
<li>display retina outputs</li>
</ul>
</li>
</ul>
<p>C++ version (see bioinspired&#x2F;samples&#x2F;basicRetina.cpp) : </p>
<p>@code{.cpp}<br>&#x2F;&#x2F; include bioinspired module and OpenCV core utilities<br>#include “opencv2&#x2F;bioinspired.hpp”<br>#include “opencv2&#x2F;imgcodecs.hpp”<br>#include “opencv2&#x2F;videoio.hpp”<br>#include “opencv2&#x2F;highgui.hpp”<br>#include <iostream></p>
<p>&#x2F;&#x2F; main function<br>int main(int argc, char* argv[]) {<br>    &#x2F;&#x2F; declare the retina input buffer.<br>    cv::Mat inputFrame;<br>    &#x2F;&#x2F; setup webcam reader and grab a first frame to get its size<br>    cv::VideoCapture videoCapture(0);<br>    videoCapture&gt;&gt;inputFrame;</p>
<pre><code>// allocate a retina instance with input size equal to the one of the loaded image
cv::Ptr&lt;cv::bioinspired::Retina&gt; myRetina = cv::bioinspired::createRetina(inputFrame.size());

/* retina parameters management methods use sample
   -&gt; save current (here default) retina parameters to a xml file (you may use it only one time to get the file and modify it)
*/
myRetina-&gt;write(&quot;RetinaDefaultParameters.xml&quot;);

// -&gt; load parameters if file exists
myRetina-&gt;setup(&quot;RetinaSpecificParameters.xml&quot;);

// reset all retina buffers (open your eyes)  
myRetina-&gt;clearBuffers();

// declare retina output buffers
cv::Mat retinaOutput_parvo;
cv::Mat retinaOutput_magno;

//main processing loop
while(true){
    // if using video stream, then, grabbing a new frame, else, input remains the same
    if (videoCapture.isOpened())
        videoCapture&gt;&gt;inputFrame;
    else
        break;
    imshow(&#39;input frame&#39;, inputImage)
    // run retina on the input image
    myRetina-&gt;run(inputFrame);
    // grab retina outputs
    myRetina-&gt;getParvo(retinaOutput_parvo);
    myRetina-&gt;getMagno(retinaOutput_magno);
    // draw retina outputs
    cv::imshow(&quot;retina input&quot;, inputFrame);
    cv::imshow(&quot;Retina Parvo&quot;, retinaOutput_parvo);
    cv::imshow(&quot;Retina Magno&quot;, retinaOutput_magno);
    cv::waitKey(5);
    }
</code></pre>
<p>}<br>@endcode<br>Compile this C++ code with the following command :<br>@code{.sh}<br>&#x2F;&#x2F; compile<br>g++ basicRetina.cpp -o basicRetina -lopencv_core -lopencv_highgui -lopencv_bioinspired -lopencv_videoio -lopencv_imgcodecs<br>@endcode</p>
<p>Python version</p>
<p>@code{.py}<br>#import OpenCV module<br>import cv2 as cv</p>
<p>#setup webcam reader<br>videoHandler &#x3D; cv.VideoCapture(0)<br>succeed, inputImage&#x3D;videoHandler.read()</p>
<p>#allocate a retina instance with input size equal to the one of the loaded image<br>retina &#x3D; cv.bioinspired_Retina.create((inputImage.shape[1], inputImage.shape[0]))</p>
<p>#retina parameters management methods use sample<br>#-&gt; save current (here default) retina parameters to a xml file (you may use it only one time to get the file and modify it)<br>retina.write(‘retinaParams.xml’)<br>#-&gt; load retina parameters from a xml file : here we load the default parameters that we just wrote to file<br>retina.setup(‘retinaParams.xml’)</p>
<p>#main processing loop<br>stillProcess&#x3D;True<br>while stillProcess is True:</p>
<pre><code>#grab a new frame and display it
stillProcess, inputImage=videoHandler.read()
cv.imshow(&#39;input frame&#39;, inputImage)

#run retina on the input image
retina.run(inputImage)

#grab retina outputs
retinaOut_parvo=retina.getParvo()
retinaOut_magno=retina.getMagno()

#draw retina outputs
cv.imshow(&#39;retina parvo out&#39;, retinaOut_parvo)
cv.imshow(&#39;retina magno out&#39;, retinaOut_magno)

#wait a little to let the time for figures to be drawn
cv.waitKey(2)
</code></pre>
<p>@endcode</p>
<h4 id="More-complete-demos"><a href="#More-complete-demos" class="headerlink" title="More complete demos"></a>More complete demos</h4><p>@note Complementary to the following examples, have a look at the Retina tutorial in the<br>tutorial&#x2F;contrib section for complementary explanations.**</p>
<p>Take a look at the provided C++ examples provided with OpenCV :</p>
<ul>
<li><p><strong>samples&#x2F;cpp&#x2F;retinademo.cpp</strong> shows how to use the retina module for details enhancement (Parvo channel output) and transient maps observation (Magno channel output). You can play with images, video sequences and webcam video.<br>Typical uses are (provided your OpenCV installation is situated in folder <em>OpenCVReleaseFolder</em>)</p>
<ul>
<li>image processing : <strong>OpenCVReleaseFolder&#x2F;bin&#x2F;retinademo -image myPicture.jpg</strong></li>
<li>video processing : <strong>OpenCVReleaseFolder&#x2F;bin&#x2F;retinademo -video myMovie.avi</strong></li>
<li>webcam processing: <strong>OpenCVReleaseFolder&#x2F;bin&#x2F;retinademo -video</strong></li>
</ul>
<p>@note This demo generates the file <em>RetinaDefaultParameters.xml</em> which contains the<br>default parameters of the retina. Then, rename this as <em>RetinaSpecificParameters.xml</em>, adjust<br>the parameters the way you want and reload the program to check the effect.</p>
</li>
<li><p><strong>samples&#x2F;cpp&#x2F;OpenEXRimages_HDR_Retina_toneMapping.cpp</strong> shows how to use the retina to<br>perform High Dynamic Range (HDR) luminance compression</p>
<p>Then, take a HDR image using bracketing with your camera and generate an OpenEXR image and<br>then process it using the demo.</p>
<p>Typical use, assuming that you have the OpenEXR image such as <em>memorial.exr</em> (present in the<br>samples&#x2F;cpp&#x2F; folder)</p>
</li>
<li><p><strong>OpenCVReleaseFolder&#x2F;bin&#x2F;OpenEXRimages_HDR_Retina_toneMapping memorial.exr [optional:<br>‘fast’]</strong></p>
<p>Note that some sliders are made available to allow you to play with luminance compression.</p>
<p>If not using the ‘fast’ option, then, tone mapping is performed using the full retina model<br>@cite Benoit2010 . It includes spectral whitening that allows luminance energy to be reduced.<br>When using the ‘fast’ option, a simpler method is used, it is an adaptation of the<br>algorithm presented in @cite Meylan2007 . This method also gives  good results and it is faster to<br>process but it sometimes requires some more parameters adjustement.</p>
</li>
</ul>
