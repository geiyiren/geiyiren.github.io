<h1 id="Object-Detection-using-Convolutional-Neural-Networks"><a href="#Object-Detection-using-Convolutional-Neural-Networks" class="headerlink" title="Object Detection using Convolutional Neural Networks"></a>Object Detection using Convolutional Neural Networks</h1><p>This module uses Convolutional Neural Networks for detecting objects in an image</p>
<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><ul>
<li>opencv dnn module</li>
<li>Google Protobuf</li>
</ul>
<h2 id="Building-this-module"><a href="#Building-this-module" class="headerlink" title="Building this module"></a>Building this module</h2><p>Run the following command to build this module:</p>
<pre><code class="make">cmake -DOPENCV_EXTRA_MODULES_PATH=&lt;opencv_contrib&gt;/modules -Dopencv_dnn_objdetect=ON &lt;opencv_source_dir&gt;
</code></pre>
<h2 id="Models"><a href="#Models" class="headerlink" title="Models"></a>Models</h2><p>There are two models which are trained.</p>
<h4 id="SqueezeNet-model-trained-for-Image-Classification"><a href="#SqueezeNet-model-trained-for-Image-Classification" class="headerlink" title="SqueezeNet model trained for Image Classification."></a>SqueezeNet model trained for Image Classification.</h4><ul>
<li>This model was trained for 1500000 iterations with a batch size of 16</li>
<li>Size of Model: 4.9MB</li>
<li>Top-1 Accuracy on ImageNet 2012 DataSet: 56.10%</li>
<li>Top-5 Accuracy on ImageNet 2012 DataSet: 79.54%</li>
<li>Link to trained weights: <a href="https://github.com/kvmanohar22/caffe/blob/obj_detect_loss/proto/SqueezeNet.caffemodel">here</a> (<a href="https://github.com/opencv/opencv_3rdparty/tree/dnn_objdetect_20170827">copy</a>)</li>
</ul>
<h4 id="SqueezeDet-model-trained-for-Object-Detection"><a href="#SqueezeDet-model-trained-for-Object-Detection" class="headerlink" title="SqueezeDet model trained for Object Detection"></a>SqueezeDet model trained for Object Detection</h4><ul>
<li>This model was trained for 180000 iterations with a batch size of 16</li>
<li>Size of the Model: 14.2MB</li>
<li>Link to the trained weights: <a href="https://github.com/kvmanohar22/caffe/blob/obj_detect_loss/proto/SqueezeDet.caffemodel">here</a> (<a href="https://github.com/opencv/opencv_3rdparty/tree/dnn_objdetect_20170827">copy</a>)</li>
</ul>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h4 id="With-Caffe"><a href="#With-Caffe" class="headerlink" title="With Caffe"></a>With Caffe</h4><p>For details pertaining to the usage of the model, have a look at <a href="https://github.com/kvmanohar22/caffe">this repository</a></p>
<p>You can infact train your own object detection models with the loss function which is implemented.</p>
<h4 id="Without-Caffe-using-opencv-39-s-dnn-module"><a href="#Without-Caffe-using-opencv-39-s-dnn-module" class="headerlink" title="Without Caffe, using opencv&#39;s dnn module"></a>Without Caffe, using <code>opencv&#39;s dnn module</code></h4><p><code>tutorials/core_detect.cpp</code> gives an example of how to use the model to predict the bounding boxes.<br><code>tutorials/image_classification.cpp</code> gives an example of how to use the model to classify an image.</p>
<p>Hereâ€™s the brief summary of examples. For detailed usage and testing, refer <code>tutorials</code> directory.</p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h2><h3 id="Image-Classification"><a href="#Image-Classification" class="headerlink" title="Image Classification"></a>Image Classification</h3><pre><code class="c++">// Read the net along with it&#39;s trained weights
cv::dnn::net = cv::dnn::readNetFromCaffe(model_defn, model_weights);

// Read an image
cv::Mat image = cv::imread(image_file);

// Convert the image into blob
cv::Mat image_blob = cv::net::blobFromImage(image);

// Get the output of &quot;predictions&quot; layer
cv::Mat probs = net.forward(&quot;predictions&quot;);
</code></pre>
<p><code>probs</code> is a 4-d tensor of shape <code>[1, 1000, 1, 1]</code> which is obtained after the application of <code>softmax</code> activation.</p>
<h3 id="Object-Detection"><a href="#Object-Detection" class="headerlink" title="Object Detection"></a>Object Detection</h3><pre><code class="c++">// Reading the network and weights, converting image to blob is same as Image Classification example.

// Forward through the network and collect blob data
cv::Mat delta_bboxs = net.forward(&quot;slice&quot;)[0];
cv::Mat conf_scores = net.forward(&quot;softmax&quot;);
cv::Mat class_scores = net.forward(&quot;sigmoid&quot;);
</code></pre>
<p>Three blobs aka <code>delta_bbox</code>, <code>conf_scores</code>, <code>class_scores</code> are post-processed in <code>cv::dnn_objdetect::InferBbox</code> class and the bounding boxes predicted.</p>
<pre><code class="c++">InferBbox infer(delta_bbox, class_scores, conf_scores);
infer.filter();
</code></pre>
<p><code>infer.filter()</code> returns vector of <code>cv::dnn_objdetect::object</code> of predictions. Here <code>cv::dnn_objdetect::object</code> is a structure containing the following elements.</p>
<pre><code class="c++">typedef struct {
  int xmin, xmax;
  int ymin, ymax;
  int class_idx;
  std::string label_name;
  double class_prob;
} object;
</code></pre>
<p>For further details on post-processing refer this detailed <a href="https://kvmanohar22.github.io/GSoC/">blog-post</a>.</p>
<h2 id="Results-from-Object-Detection"><a href="#Results-from-Object-Detection" class="headerlink" title="Results from Object Detection"></a>Results from Object Detection</h2><p>Refer <code>tutorials</code> directory for results.</p>
